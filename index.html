<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Full Reading Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 16px;
        }



        .header {
            background-color: #ffffff;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 60px;
        }

        .ielts-logo {
            display: none;
        }
        .logo-ja {
            padding-top: 20px;
            height: 10%;
            width: 10%;
            display: block; /* Important! */
            margin-left: auto;
            margin-right: auto;
        }

        .test-info {
            display: flex;  
            align-items: center;
            gap: 30px;
            font-size: 14px;
            color: #333;
        }

        .audio-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .audio-icon {
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>') no-repeat center;
        }

        .header-icons {
            display: flex;
            gap: 10px;
            align-items: center;
        }


        #volume-slider {
            -webkit-appearance: none;
            width: 80px;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
        }

        #volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
            border: none;
        }

        .icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.7;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon:hover {
            opacity: 1;
        }
        
        #play-pause-btn {
            background: none;
            border: none;
            padding: 0;
        }

        .main-container {
            margin-top: 60px;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            height: calc(100vh - 60px); /* Full height minus header */
            position: relative;
        }

        /* Page watermark */
        body::after {
            content: "JUNED ACADEMY";
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) rotate(-20deg);
            font-size: 72px;
            font-weight: 800;
            letter-spacing: 2px;
            color: #000000;
            opacity: 0.04; /* subtle */
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
        }

        .panels-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .passage-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
        }

        /* Passage Content */
        .text-center {
            text-align: center;
        }
        .reading-passage h4 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
       
        .reading-passage p {
            margin-bottom: 1.2em;
        }

        .question ul li label {
            display: block;
            margin-top: 8px;
            cursor: pointer;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }

        .resizer {
            width: 10px;
            cursor: col-resize;
            background-color: #f0f0f0;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="30" viewBox="0 0 10 30"><path d="M4 11h2v2H4zM4 15h2v2H4zM4 19h2v2H4z" fill="%23888"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            flex-shrink: 0;
            flex-grow: 0;
        }

        /* Left Panel */
        .left-panel {
            width: 100%;
            padding: 20px;
        }

        /* Right Panel */
        .right-panel {
            display: none;
            width: 50%;
            padding: 20px;
            position: relative;
        }

        .help-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }

        .help-button:hover {
            background: #357abd;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .people-section {
            margin-bottom: 30px;
        }

        .people-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ccc;
        }

        .people-table th {
            text-align: left;
            padding: 10px;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .people-table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
        }

        .person-name {
            font-size: 16px;
        }

        .question-number {
            background: white;
            border: 1px solid #4a90e2;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
            color: #4a90e2;
            min-width: 30px;
            text-align: center;
        }

        .assigned-responsibility {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 14px;
            border: 1px solid #ddd;
        }

        .responsibilities-section {
            margin-bottom: 30px;
        }

        .responsibility-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .responsibility-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .responsibility-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .responsibility-item.dragging {
            opacity: 0.5;
        }

        .questions-section {
            margin-bottom: 20px;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instruction {
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }

        /* Map Styles */
        .map-container {
            position: relative;
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        .map-svg {
            border: 2px solid #333;
            background: white;
        }

        .map-room {
            fill: #f9f9f9;
            stroke: #333;
            stroke-width: 1;
        }

        .map-text {
            font-family: Arial, sans-serif;
            font-size: 13px;
            text-anchor: middle;
            fill: #333;
        }

        .map-number {
            font-family: Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            text-anchor: middle;
            fill: #333;
        }

        .room-labels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .room-label {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .room-label:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .room-label.dragging {
            opacity: 0.5;
        }

        /* Navigation Arrows */
        .nav-arrows {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            gap: 6px;
            z-index: 101;
        }

        .nav-arrow {
            width: 48px;
            height: 48px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: #fff;
            transition: transform 0.1s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
            outline: none;
        }
        .nav-arrow.prev { background-color: #4b5563; }
        .nav-arrow.next { background-color: #000000; }

        .nav-arrow:hover { transform: translateY(-1px); }
        .nav-arrow:active { transform: translateY(0); }
        .nav-arrow:focus-visible { box-shadow: 0 0 0 3px rgba(59,130,246,0.4); }

        .nav-arrow:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Bottom Navigation - Exact Match */
        .nav-row {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
        
            padding: 0;
            display: flex;
            align-items: center;
            height: 80px;
            z-index: 100;
        }

        .footer__questionWrapper___1tZ46 {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }


        .footer__questionNo___3WNct {
            background: none;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }

        .footer__questionNo___3WNct:hover {
            background-color: #f8f9fa;
        }

        .section-prefix {
            font-size: 16px;
        }

        .sectionNr {
            font-size: 16px;
            font-weight: bold;
        }

        .attemptedCount {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
            font-weight: 400; /* Normal weight */
        }

        @media (max-width: 768px) {
            .attemptedCount {
                display: none;
            }
        }

        .footer__questionWrapper___1tZ46.selected .attemptedCount {
            display: none;
        }

        .footer__subquestionWrapper___9GgoP {
            display: none;
            gap: 2px;
            margin-left: 10px;
        }

        .footer__questionWrapper___1tZ46.selected .footer__subquestionWrapper___9GgoP {
            display: flex;
        }

        .subQuestion {
            width: 32px;
            height: 32px;
            border: 1px solid #ccc;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .subQuestion.answered {
            background-color: #e9ecef;
            border-color: #ddd;
        }
        .subQuestion.correct {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }
        .subQuestion.incorrect {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .subQuestion:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

        .subQuestion.active {
            background-color: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .subQuestion.completed {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .footer__deliverButton___3FM07 {
            margin-left: auto;
            margin-right: 20px;
            background-color: #f3f4f6;
            color: #111827;
            border: 1px solid #d1d5db;
            padding: 10px 16px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.08s ease, background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            min-width: 160px;
            justify-content: center;
        }

        .footer__deliverButton___3FM07:hover {
            background-color: #ebedf0;
            border-color: #c7ccd4;
        }

        .footer__deliverButton___3FM07:active {
            transform: translateY(1px);
        }

        .footer__deliverButton___3FM07:focus-visible {
            box-shadow: 0 0 0 3px rgba(59,130,246,0.35);
            outline: none;
        }

        .footer__deliverButton___3FM07:disabled {
            background: #eef0f3;
            color: #9ca3af;
            cursor: not-allowed;
            border-color: #e5e7eb;
            box-shadow: none;
        }

        

        .hidden {
            display: none !important;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            min-width: 140px;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: #f8f9fa;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background-color: #ffff00;
        }

        .comment-highlight {
            background-color: #90EE90;
            position: relative;
            cursor: help;
        }

        .comment-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .comment-highlight:hover .comment-tooltip {
            opacity: 1;
        }

        .question {
            margin-bottom: 40px;
        }
        .question p {
            margin-bottom: 10px;
        }
        .question ul, .question .people-table {
            margin-top: 0;
        }
        .question-prompt {
            margin-bottom: 20px;
        }
        .question ul {
            list-style: none;
            padding-left: 0;
        }
        .question ul li {
            margin-bottom: 5px;
        }
        .answer-input {
            border: 1px solid #bfbfbf;
            border-radius: 4px;
            background-color: #fff;
            padding: 2px 8px;
            font-size: 16px;
            text-align: left;
            font-weight: 700;
            margin-right: 6px;
            margin-left: 6px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            height: 28px;
            min-width: 150px;
        }
        .answer-input.active-input,
        .answer-input:focus {
            border-color: #3581d8;
            border-width: 2px;
            outline: none;
        }
        .answer-input::placeholder {
            color: #666;
            font-weight: 700;
            text-align: center;
        }
        .answer-input.correct {
            border-color: #28a745;
            background-color: #e9f7ef;
        }
        .answer-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .answer-input {
    z-index: 10;
    position: relative;
    pointer-events: auto;
}
        .summary-text .answer-input {
            width: 120px;
            height: 24px;
            font-size: 14px;
            margin: 0 4px;
        }
        .answer-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        .answer-inputs .answer-input {
            width: 200px;
            height: 30px;
            font-size: 16px;
        }
        .drag-drop-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            align-items: flex-start;
        }
        .recommendations-box {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 200px;
        }
        .drag-item {
            background: white;
            border: 1px solid #9c9c9c;
            font-weight: 600;
            padding: 0px 5px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
        }
        .drag-item:hover {
            background: #e9ecef;
        }
        .drag-item.dragging {
            opacity: 0.5;
        }
        .drag-item.selected {
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.5);
        }
        .drop-zone {
            border: 2px dashed #aaa;
            border-radius: 4px;
            width: 50%;
            margin-top: 19px;
            margin-bottom: 5px;
            transition: background-color 0.2s, border-color 0.2s;
            padding: 0.5px;
            display: flex;
            align-items: center;
            position: relative;
            color: #afafaf;
            font-weight: 600;
            height: 27px;
        }
        .drop-zone.drag-over {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        .drop-zone.correct {
            background-color: #e9f7ef;
            border-color: #28a745;
            border-style: solid;
        }
        .drop-zone.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            border-style: solid;
        }
        .drop-zone.disabled {
            pointer-events: none;
        }
        .drop-zone .drag-item {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            padding: 2px;
        }
        .drag-options-container {
            margin-top: 10px;
        }
        .drag-options-container .drag-item {
            display: block;
            width: fit-content;
            font-size: 15px;
            padding: 0.5px 10px;
            margin-bottom: 5px;
        }
        .drag-options-container .drag-item:last-child {
            margin-bottom: 0;
        }
        .q-number {
            color: #888;
            font-size: 14px;
            font-weight: bold;
        }
        .questions-container {
            width: 100%;
        }
        audio {
            width: 100%;
            margin-bottom: 20px;
        }
        .part-header {
            background-color: #f1f2ec;
            padding: 15px 20px;
            border: 1px solid #e0e0e0;
            text-align: left;
            margin: 10px 20px;
            border-radius: 5px;
        }
        .part-header p {
            margin: 0;
        }
        .part-header p:first-child {
            margin-bottom: 5px;
        }

        .question li.correct {
            color: #155724;
            font-weight: bold;
        }
        .question li.incorrect {
            color: #721c24;
        }
        .question li.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .question li.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }

        .example-box {
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .timer-container {
            display: flex;
            position: relative;
            cursor: default;
            color: #333;
            font-size: 16px;
            font-weight: 500;
            align-items: center;
        }
        .timer-container .timer-tooltip {
            display: none;
        }

        .timer-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }

        .timer-controls button {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .timer-controls button:hover {
            background: #e0e0e0;
        }

        .timer-controls button svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }

        .audio-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 40, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        .audio-modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 500px;
            padding: 20px;
        }
        .audio-modal-content p {
            font-size: 16px;
            line-height: 1.5;
            color: #eee;
        }
        .audio-modal-icon {
            margin-bottom: 20px;
        }
        .modal-play-btn {
            background-color: #000;
            color: white;
            border: 1px solid white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        .modal-play-btn:hover {
            background-color: #333;
        }
        #goto-widget {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #goto-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #goto-btn {
            padding: 4px 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Styles for TRUE/FALSE/NOT GIVEN questions */
        .tf-question {
            margin-bottom: 25px;
            padding: 10px 0px;
            border-radius: 4px;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .tf-question-line {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 5px 0px;
            border-radius: 4px;
        }
        .tf-question-number, .question-number-box {
            border: 2px solid #ccc;
            padding: 2px 8px;
            margin-right: 10px;
            border-radius: 3px;
            font-weight: bold;
            transition: border-color 0.3s;
            display: inline-block;
        }
        /* Active question blue outline for TF (clears when navigating away) */
        .tf-question.active-question .tf-question-number {
            border-color: #4a90e2;
        }
        .tf-question-text {
            padding-top: 3px;
        }
        .tf-options {
            padding-left: 5px;
        }
        .tf-option {
            display: block;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 10px 12px;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            background-color: #fff;
        }
        .tf-option:hover {
            background-color: #f1f7ff;
            border-color: #c6dcfb;
        }
        .tf-option:has(input[type="radio"]:checked) {
            background-color: #cfe3f9;
            border-color: #7db3f5;
        }
        /* Answer checking states for TF/NG */
        .tf-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            border-width: 1px;
        }
        .tf-option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            border-width: 1px;
        }
        /* Ensure selected-blue visuals don't conflict once results are shown */
        body.results-mode .tf-option:has(input[type="radio"]:checked) {
            box-shadow: none;
        }
        .tf-option input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .tf-question.correct .tf-question-line {
            background-color: #e9f7ef;
        }
        .tf-question.incorrect .tf-question-line {
            background-color: #f8d7da;
        }
        .matching-question-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 15px;
        }
        .matching-options-bank {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .matching-questions {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .matching-question-item {
            display: flex;
            align-items: center;
            gap: 15px;

            border: 2px solid transparent;
            border-radius: 4px;
            transition: border-color 0.3s;
        }
        .matching-question-item > span {
            flex: 1;
        }
        .matching-question-item.correct {
            background-color: #e9f7ef;
            border-color: #28a745 !important;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone {
            width: auto;
            min-width: 200px;
            flex-shrink: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            font-weight: bold;
            color: #aaa;
        }
        .matching-options-bank .drag-item {
            font-size: 15px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            max-width: 700px;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .summary-completion-container {
            margin-top: 20px;
        }
        .summary-text p {
            line-height: 3.0;
            font-size: 16px;
            margin-bottom: 12px;
        }
        .summary-text li {
            line-height: 2.2;
            margin-bottom: 10px;
        }
        .summary-drop-zone {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            max-width:200px;
            height: 25px;
            border: 2px dashed #999;
            border-radius: 4px;
            margin: 0 5px;
            padding: 0 5px;
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
            color: #aaa;
            font-weight: bold;
        }
        .summary-drop-zone.filled {
            border-color: #4a90e2;
        }
        .summary-drop-zone.active-input {
             border-color: #4a90e2;
             box-shadow: none;
        }
        .summary-drop-zone .drag-item {
            font-size: 15px;
            font-weight: bold;
            background-color: transparent;
            border: none;
            padding: 0;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .summary-options-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .summary-options-bank .drag-item {
            flex-grow: 1;
            min-width: 100px;
            text-align: center;
        }

        /* Filled drop-zone pill styling */
        .drop-zone.filled {
            background-color: transparent;
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
            padding: 0;
        }
        .drop-zone.filled .drag-item {
            width: auto;
            height: auto;
            display: inline-block;
            border: 2px solid #4a90e2;
            border-radius: 10px;
            padding: 4px 10px;
            font-weight: 700;
            background: #fff;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.15);
            cursor: default;
            white-space: nowrap;
        }
        .multi-choice-question {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 4px;
            border: 3px solid transparent;
            transition: border-color 0.3s, background-color 0.3s;
        }
        /* MCQ number badge: style first strong within prompt */
        .multi-choice-question .question-prompt p > strong:first-child {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            padding: 2px 6px;
            margin-right: 8px;
            border: 1px solid #d0d7e2;
            border-radius: 6px;
            background: #fff;
        }
        /* Active question blue outline for MCQ (clears when navigating away) */
        .multi-choice-question.active-question .question-prompt p > strong:first-child {
            border-color: #4a90e2;
            border-width: 2px;
        }
        .multi-choice-option {
            padding: 10px 12px;
            background-color: #fff;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .multi-choice-option:hover {
            background-color: #f1f7ff;
            border-color: #c6dcfb;
        }
        .multi-choice-option:has(input:checked) {
            background-color: #cfe3f9;
            border-color: #7db3f5;
        }
        /* Answer checking states for MCQ */
        .multi-choice-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            /* box-shadow: inset 0 0 0 2px rgba(40, 167, 69, 0.25) !important; */
            border-width: 1px;
            /* border-radius: 6px; */
        }
        .multi-choice-option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            /* box-shadow: inset 0 0 0 2px rgba(220, 53, 69, 0.25) !important; */
            border-width: 1px;
            /* border-radius: 6px; */
        }
        /* Correct answer reveal for unselected option after checking */
        .tf-option.correct-answer-highlight,
        .multi-choice-option.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
        }
        body.results-mode .multi-choice-option:has(input:checked) { box-shadow: none; }
        .multi-choice-option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
        }
        .multi-choice-option input[type="checkbox"],
        .multi-choice-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.3);
            accent-color: #4a90e2;
        }
        .multi-choice-option.correct {
            background-color: #e9f7ef;
        }
        .multi-choice-option.incorrect {
            background-color: #f8d7da;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone.filled {
            border-color: #4a90e2;
        }
        .matching-question-item .drop-zone {
            width: 200px;
            height: 40px;
        }
        .paragraph-matching-question {
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 12px;
        }
        .paragraph-matching-question .answer-input {
            width: 80px;
            flex-shrink: 0;
        }

        .matching-form-container {
            margin-top: 20px;
        }
        .matching-form-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .matching-form-label {
            flex-shrink: 0;
        }

        /* Results Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(3px);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.hidden {
            display: none;
        }
        .modal-content {
            background: #ffffff;
            padding: 24px;
            border-radius: 14px;
            width: 92%;
            max-width: 780px;
            max-height: 86vh;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid #e5e7eb;
            box-shadow: 0 20px 60px rgba(0,0,0,0.25);
        }
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }
        .modal-content h2 {
            text-align: center;
            margin-bottom: 18px;
            color: #111827;
        }
        .results-summary {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 16px;
            text-align: center;
            border-bottom: 1px solid #eef2f7;
            padding-bottom: 12px;
        }
        .results-summary p {
            margin: 0;
            font-size: 14px;
            color: #374151;
        }
        .results-summary p span {
            display: inline-block;
            padding: 4px 10px;
            margin-left: 6px;
            border-radius: 999px;
            background: #f3f4f6;
            font-weight: 700;
            color: #111827;
        }
        .results-details-container {
            overflow-y: auto;
            padding-right: 10px; /* For scrollbar */
            border-radius: 8px;
        }
        .result-row {
            display: grid;
            grid-template-columns: 56px 1fr 1fr;
            gap: 12px;
            padding: 10px 8px;
            border-bottom: 1px solid #eef2f7;
            font-size: 15px;
            align-items: center;
        }
        .result-row.correct {
            background-color: #f3faf5;
        }
        .result-row.incorrect {
            background-color: #fff5f5;
        }
        .result-row .q-num {
            font-weight: 700;
            color: #111827;
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            width: 42px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .result-row .user-ans {
            color: #374151;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            padding: 4px 8px;
            border-radius: 6px;
        }
        .result-row .correct-ans {
            color: #065f46;
            font-weight: 600;
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            padding: 4px 8px;
            border-radius: 6px;
        }
        .correct-answer-display {
            font-weight: bold;
            color: #28a745;
            margin-left: 10px;
            font-size: 14px;
        }
        
        
        .centered-title {
    text-align: center;
    font-size: 50px;
    font-weight: bold;
    margin-bottom: 15px;
}

        .matching-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .matching-table th {
            background-color: #007bff;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ddd;
        }
        
        .matching-table td {
            padding: 12px;
            border: 1px solid #ddd;
            vertical-align: top;
        }
        
        .matching-table .statement {
            text-align: left;
            width: 60%;
        }
        
        .matching-table .table-radio {
            margin: 0;
            transform: scale(1.2);
        }
        
        .matching-table td:not(.statement) {
            text-align: center;
            width: 6.67%;
            min-width: 60px;
        }
        
        .matching-table th:not(:first-child) {
            width: 6.67%;
            min-width: 60px;
        }
        
        .matching-table td:not(.statement):has(input:checked) {
            background-color: #e3f2fd;
        }
        
        .matching-table input[type="radio"]:checked {
            accent-color: #007bff;
        }
        
        .matching-table td.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table td.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb;
        }
        
        .matching-table td.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .options-row {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        
        .matching-table .options-row td {
            font-weight: 500;
            text-align: center;
            padding: 8px 12px;
            font-size: 13px;
        }
        
        .matching-table .options-row td:first-child {
            text-align: left;
            font-weight: normal;
        }
        
        .matching-table td.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .clickable-cell {
            cursor: pointer;
            transition: background-color 0.2s ease;
            min-height: 40px;
            border: 1px solid #ddd;
            position: relative;
        }
        
        .matching-table .clickable-cell:hover {
            background-color: #f0f8ff;
            border-color: #007bff;
        }
        
        .matching-table .clickable-cell.selected {
            background-color: #e3f2fd;
        }
        
        .matching-table .clickable-cell.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .clickable-cell.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb;
        }
        
        .matching-table .clickable-cell::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: transparent;
            transition: background-color 0.2s ease;
        }
        
        .matching-table .clickable-cell.selected::after {
        }
        
        /* Explanation Section Styles */
        .explanation-section {
            margin-top: 40px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .explanation-section h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }
        
        .explanation-content p {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 16px;
        }
        
        .explanation-content strong {
            color: #4a90e2;
            font-weight: 600;
        }
        
        #show-explanation-btn {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        #show-explanation-btn:hover {
            background-color: #357abd;
        }

        /* Drag & Drop for Part 2 Paragraph Headings */
        .paragraph-drop-zone {
            border: 2px dashed #ccc;
            border-radius: 6px;
            padding: 6px 8px;
            margin: 8px 0;
            max-height: 28px;
            background-color: #f9f9f9;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            display: flex;
            align-items: center;
            font-weight: bold;
            color: #666;
            width: 97%;
        }
        .paragraph-drop-zone.drag-over {
            border-color: #4a90e2;
            background-color: #e3f2fd;
        }
        .paragraph-drop-zone.filled {
            border-color: #2196f3;
            background-color: #e3f2fd;
            color: #333;
            cursor: move;
        }
        
        /* Ensure correct/incorrect states override filled state */
        .paragraph-drop-zone.filled.correct {
            border-color: #4caf50 !important;
            background-color: #e8f5e8 !important;
        }
        
        .paragraph-drop-zone.filled.incorrect {
            border-color: #f44336 !important;
            background-color: #ffebee !important;
        }
        
        .paragraph-drop-zone.correct {
            border-color: #4caf50 !important;
            background-color: #e8f5e8 !important;
        }
        
        .paragraph-drop-zone.incorrect {
            border-color: #f44336 !important;
            background-color: #ffebee !important;
        }
        .heading-options-container {
            /* border: 1px solid #eeeeee; */
            border-radius: 6px;
            /* padding: 10px; */
            /* background: #fafafa; */
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .heading-drag-item {
            /* background-color: #f5f5f5; */
            /* border: 1px solid #dddddd; */
            /* border-radius: 6px; */
            /* padding: 8px 10px; */
            /* cursor: grab; */
            /* user-select: none; */
            /* font-weight: 500; */
            /* transition: all 0.2s ease; */
            background: white;
            border: 1px solid #9c9c9c;
            font-weight: 600;
            padding: 0px 5px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
        }
        .heading-drag-item:hover {
            background-color: #e9ecef;
            border-color: #adb5bd;
        }
        .heading-drag-item.dragging {
            opacity: 0.6;
        }
        .heading-drag-item.used {
            display: none;
        }

        /* Flow Chart Styling */
        .flow-chart {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            margin: 20px 0;
            padding: 20px;
            /* background: #f8f9fa; */
            /* border-radius: 8px; */
            /* border: 1px solid #dee2e6; */
        }

        .flow-step {
            background: white;
            border: 2px solid #333;
            border-radius: 0;
            padding: 15px 20px;
            /* width: 400px; */
            text-align: left;
            position: relative;
            font-size: 14px;
            line-height: 1.4;
            margin: 0;
        }

        .flow-step.input-step {
            background: white;
            border-color: #333;
        }

        .flow-arrow {
            font-size: 24px;
            color: #333;
            font-weight: 600;
            margin: 0;
            padding: 5px 0;
            line-height: 1;
        }

        .flow-step .answer-input {
            margin: 0 2px;
            width: 40px;
            height: 24px;
            /* background: #fff; */
            /* border: 1px solid #333; */
            font-weight: bold;
            font-size: 14px;
            /* text-align: center; */
            /* padding: 2px; */
        }

        .flow-title {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            margin-bottom: 20px;
            text-align: left;
            width: 400px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="timer-container">
            <span class="timer-display">60:00</span>
            <div class="timer-controls">
                <button id="timer-toggle-btn" title="Pause/Resume Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>
                </button>
                <button id="timer-reset-btn" title="Reset Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
                </button>
            </div>
        </div>
        <div>
         <img class="logo-ja" src="https://github.com/kawsarahmedeeeee-png/Reading/blob/main/Bold.png?raw=true" alt="Juned Academy">
        </div>
    </div>

    <div class="main-container" id="main-container">
        <div id="passage-header-container">
            <div id="part-header-1" class="part-header">
                <p><strong>Part 1</strong></p>
                <p>Read the text and answer questions 1-13.</p>
            </div>
            <div id="part-header-2" class="part-header hidden">
                <p><strong>Part 2</strong></p>
                <p>Read the text and answer questions 14-26.</p>
            </div>
            <div id="part-header-3" class="part-header hidden">
                <p><strong>Part 3</strong></p>
                <p>Read the text and answer questions 27-40.</p>
            </div>
        </div>
        <div class="panels-container">
            <div class="passage-panel" id="passage-panel">
                <div id="passage-text-1" class="reading-passage">
                    <h4 class="text-center">The Forgotten Forest</h4>
                    <p>Found only in the Deep South of America, longleaf pine woodlands have dwindled to about 3 percent of their former range, but new efforts are under way to restore them.</p>
                    <p>THE BEAUTY AND THE BIODIVERSITY of the longleaf pine forest are well-kept secrets, even in its native South. Yet it is among the richest ecosystems in North America, rivaling tallgrass prairies and the ancient forests of the Pacific Northwest in the number of species it shelters. And like those two other disappearing wildlife habitats, longleaf is also critically endangered.</p>
                    <p>In longleaf pine forests, trees grow widely scattered, creating an open, parklike environment, more like a savanna than a forest. The trees are not so dense as to block the sun. This openness creates a forest floor that is among the most diverse in the world, where plants such as many-flowered grass pinks, trumpet pitcher plants, Venus flytraps, lavender ladies and pineland bog-buttons grow. As many as 50 different species of wildflowers, shrubs, grasses and ferns have been cataloged in just a single square meter.</p>
                    <p>Once, nearly 92 million acres of longleaf forest flourished from Virginia to Texas, the only place in the world where it is found. By the turn of the 21st century, however, virtually all of it had been logged, paved or farmed into oblivion. Only about 3 percent of the original range still supports longleaf forest, and only about 10,000 acres of that is uncut old-growth—the rest is forest that has regrown after cutting. An estimated 100,000 of those acres are still vanishing every year. However, a quiet movement to reverse this trend is rippling across the region. Governments, private organisations (including NWF) and individual conservationists are looking for ways to protect and preserve the remaining longleaf and to plant new forests for future generations.</p>
                    <p>Figuring out how to bring back the piney woods also will allow biologists to help the plants and animals that depend on this habitat. Nearly two-thirds of the declining, threatened or endangered species in the southeastern United States are associated with longleaf. The outright destruction of longleaf is only part of their story, says Mark Danaher, the biologist for South Carolina's Francis Marion National Forest. He says the demise of these animals and plants also is tied to a lack of fire, which once swept through the southern forests on a regular basis. "Fire is absolutely critical for this ecosystem and for the species that depend on it," says Danaher.</p>
                    <p>Name just about any species that occurs in longleaf and you can find a connection to fire. Bachman's sparrow is a secretive bird with a beautiful song that echoes across the longleaf flatwoods. It tucks its nest on the ground beneath clumps of wiregrass and little bluestem in the open under-story. But once fire has been absent for several years, and a tangle of shrubs starts to grow, the sparrows disappear. Gopher tortoises, the only native land tortoises east of the Mississippi, are also abundant in longleaf. A keystone species for these forests, its burrows provide homes and safety to more than 300 species of vertebrates and invertebrates ranging from eastern diamond-back rattlesnakes to gopher frogs. If fire is suppressed, however, the tortoises are choked out. "If we lose fire," says Bob Mitchell, an ecologist at the Jones Center, "we lose wildlife."</p>
                    <p>Without fire, we also lose longleaf. Fire knocks back the oaks and other hardwoods that can grow up to overwhelm longleaf forests. "They are fire forests," Mitchell says. "They evolved in the lightning capital of the eastern United States." And it wasn't only lightning strikes that set the forest aflame. "Native Americans also lit fires to keep the forest open," Mitchell says. "So did the early pioneers. They helped create the longleaf pine forests that we know today."</p>
                    <p>Fire also changes how nutrients flow throughout longleaf ecosystems, in ways we are just beginning to understand. For example, researchers have discovered that frequent fires provide extra calcium, which is critical for egg production, to endangered red-cockaded woodpeckers. Frances James, a retired avian ecologist from Florida State University, has studied these small black-and-white birds for more than two decades in Florida's sprawling Apalachicola National Forest. When she realised female woodpeckers laid larger clutches in the first breeding season after their territories were burned, she and her colleagues went searching for answers. "We learned calcium is stashed away in woody shrubs when the forest is not burned," James says. "But when there is a fire, a pulse of calcium moves down into the soil and up into the longleaf." Eventually, this calcium makes its way up the food chain to a tree-dwelling species of ant, which is the red-cockaded's favorite food. The result: more calcium for the birds, which leads to more eggs, more young and more woodpeckers.</p>
                    <p>Today, fire is used as a vital management tool for preserving both longleaf and its wildlife. Most of these fires are prescribed burns, deliberately set with a drip torch. Although the public often opposes any type of fire—and the smoke that goes with it—these frequent, low-intensity burns reduce the risk of catastrophic conflagrations. "Forests are going to burn," says Amadou Diop, NWF's southern forests restoration manager. "It's just a question of when. With prescribed burns, we can pick the time and the place."</p>
                    <p>Diop is spearheading a new NWF effort to restore longleaf. "It's a species we need to go back to," he says. Educating landowners about the advantages of growing longleaf is part of the program, he adds, which will soon be under way in nine southern states. "Right now, most longleaf is on public land," says Jerry McCollum, president of the Georgia Wildlife Federation. "Private land is where we need to work," he adds, pointing out that more than 90 percent of the acreage within the historic range of longleaf falls under this category.</p>
                    <p>Interest among private landowners is growing throughout the South, but restoring longleaf is not an easy task. The herbaceous layer—the understory of wiregrasses and other plants – also needs to be re-created. In areas where the land has not been chewed up by farming, but converted to loblolly or slash pine plantations, the seed bank of the longleaf forest usually remains viable beneath the soil. In time, this original vegetation can be coaxed back. Where agriculture has destroyed the seeds, however, wiregrass must be replanted. Right now, the expense is prohibitive, but researchers are searching for low-cost solutions.</p>
                    <p>Bringing back longleaf is not for the short-sighted, however. Few of us will be alive when the pines being planted today become mature forests in 70 to 80 years. But that is not stopping longleaf enthusiasts. "Today, it's getting hard to find longleaf seedlings to buy," one of the private landowners says. "Everyone wants them. Longleaf is in a resurgence."</p>
                </div>
                <div id="passage-text-2" class="reading-passage hidden">
                    <h4 class="text-center">Wealth in A Cold Climate</h4>
                    <p>Latitude is crucial to a nation's economic strength.</p>
                    <div class="paragraph-drop-zone" data-paragraph="A" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">14</div>
                    <p>Dr William Masters was reading a book about mosquitoes when inspiration struck. "There was this anecdote about the great yellow fever epidemic that hit Philadelphia in 1793," Masters recalls. "This epidemic decimated the city until the first frost came." The inclement weather froze out the insects, allowing Philadelphia to recover.</p>
                        <div class="paragraph-drop-zone" data-paragraph="B" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">15</div>
                    <p>If weather could be the key to a city's fortunes, Masters thought, then why not to the historical fortunes of nations? And could frost lie at the heart of one of the most enduring economic mysteries of all—why are almost all the wealthy, industrialised nations to be found at latitudes above 40 degrees? After two years of research, he thinks that he has found a piece of the puzzle. Masters, an agricultural economist from Purdue University in Indiana, and Margaret McMillan at Tufts University, Boston, show that annual frosts are among the factors that distinguish rich nations from poor ones. Their study is published this month in the Journal of Economic Growth. The pair speculate that cold snaps have two main benefits – they freeze pests that would otherwise destroy crops, and also freeze organisms, such as mosquitoes, that carry disease. The result is agricultural abundance and a big workforce.</p>
                    <div class="paragraph-drop-zone" data-paragraph="C" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">16</div>
                    <p>The academics took two sets of information. The first was average income for countries, the second climate data from the University of East Anglia. They found a curious tally between the sets. Countries having five or more frosty days a month are uniformly rich, those with fewer than five are impoverished. The authors speculate that the five-day figure is important; it could be the minimum time needed to kill pests in the soil. Masters says: "For example, Finland is a small country that is growing quickly, but Bolivia is a small country that isn't growing at all. Perhaps climate has something to do with that." In fact, limited frosts bring huge benefits to farmers. The chills kill insects or render them inactive; cold weather slows the break-up of plant and animal material in the soil, allowing it to become richer; and frosts ensure a build-up of moisture in the ground for spring, reducing dependence on seasonal rains. There are exceptions to the "cold equals rich" argument. There are well-heeled tropical places such as Hong Kong and Singapore, a result of their superior trading positions. Like-wise, not all European countries are moneyed in the former communist colonies, economic potential was crushed by politics.</p>
                    <div class="paragraph-drop-zone" data-paragraph="D" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">17</div>
                    <p>Masters stresses that climate will never be the overriding factor – the wealth of nations is too complicated to be attributable to just one factor. Climate, he feels, somehow combines with other factors such as the presence of institutions, including governments, and access to trading routes to determine whether a country will do well. Traditionally, Masters says, economists thought that institutions had the biggest effect on the economy, because they brought order to a country in the form of, for example, laws and property rights. With order, so the thinking went, came affluence. "But there are some problems that even countries with institutions have not been able to get around," he says. "My feeling is that, as countries get richer, they get better institutions. And the accumulation of wealth and improvement in governing institutions are both helped by a favourable environment, including climate."</p>
                    <div class="paragraph-drop-zone" data-paragraph="E" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">18</div>
                    <p>This does not mean, he insists, that tropical countries are beyond economic help and destined to remain penniless. Instead, richer countries should change the way in which foreign aid is given. Instead of aid being geared towards improving governance, it should be spent on technology to improve agriculture and to combat disease. Masters cites one example: "There are regions in India that have been provided with irrigation, agricultural productivity has gone up and there has been an improvement in health." Supplying vaccines against tropical diseases and developing crop varieties that can grow in the tropics would break the poverty cycle.</p>
                    <div class="paragraph-drop-zone" data-paragraph="F" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">19</div>
                    <p>Other minds have applied themselves to the split between poor and rich nations, citing anthropological, climatic and zoological reasons for why temperate nations are the most affluent. In 350 BC, Aristotle observed that "those who live in a cold climate…are full of spirit". Jared Diamond, from the University of California at Los Angeles, pointed out in his book Guns, Germs and Steel that Eurasia is broadly aligned east-west, while Africa and the Americas are aligned north-south. So, in Europe, crops can spread quickly across latitudes because climates are similar. One of the first domesticated crops, einkorn wheat, spread quickly from the Middle East into Europe; it took twice as long for corn to spread from Mexico to what is now the eastern United States. This easy movement along similar latitudes in Eurasia would also have meant a faster dissemination of other technologies such as the wheel and writing, Diamond speculates. The region also boasted domesticated livestock, which could provide meat, wool and motive power in the fields. Blessed with such natural advantages, Eurasia was bound to take off economically.</p>
                    <div class="paragraph-drop-zone" data-paragraph="G" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">20</div>
                    <p>John Gallup and Jeffrey Sachs, two US economists, have also pointed out striking correlations between the geographical location of countries and their wealth. They note that tropical countries between 23.45 degrees north and south of the equator are nearly all poor. In an article for the Harvard International Review, they concluded that "development surely seems to favour the temperate-zone economies, especially those in the northern hemisphere, and those that have managed to avoid both socialism and the ravages of war". But Masters cautions against geographical determinism, the idea that tropical countries are beyond hope: "Human health and agriculture can be made better through scientific and technological research," he says, "so we shouldn't be writing off these countries. Take Singapore: without air conditioning, it wouldn't be rich."</p>
                </div>
                <div id="passage-text-3" class="reading-passage hidden">
                    <h4 class="text-center">Motivating Drives</h4>
                    <p>Scientists have been researching the way to get employees motivated for many years. This research is a relational study which builds the fundamental and comprehensive model for study. This is especially true when the business goal is to turn unmotivated teams into productive ones. But their researchers have limitations. It is like studying the movements of car without taking out the engine.</p>
                    <p>Motivation is what drives people to succeed and plays a vital role in enhancing an organizational development. It is important to study the motivation of employees because it is related to the emotion and behavior of employees. Recent studies show there are four drives for motivation. They are the drive to acquire, the drive to bond, the drive to comprehend and the drive to defend.</p>
                    <p><strong>The Drive to Acquire</strong></p>
                    <p>The drive to acquire must be met to optimize the acquire aspect as well as the achievement element. Thus the way that outstanding performance is recognized, the type of perks that is provided to polish the career path. But sometimes a written letter of appreciation generates more motivation than a thousand dollar check, which can serve as the invisible power to boost business engagement. Successful organizations and leaders not only need to focus on the optimization of physical reward but also on moving other levers within the organization that can drive motivation.</p>
                    <p><strong>The Drive to Bond</strong></p>
                    <p>The drive to bond is also key to driving motivation. There are many kinds of bonds between people, like friendship, family. In company, employees also want to be an essential part of company. They want to belong to the company. Employees will be motivated if they find personal belonging to the company. In the meantime, the most commitment will be achieved by the employee on condition that the force of motivation within the employee affects the direction, intensity and persistence of decision and behavior in company.</p>
                    <p><strong>The Drive to Comprehend</strong></p>
                    <p>The drive to comprehend motivates many employees to higher performance. For years, it has been known that setting stretch goals can greatly impact performance. Organizations need to ensure that the various job roles provide employees with simulation that challenges them or allow them to grow. Employees don't want to do meaningless things or monotonous job. If the job didn't provide them with personal meaning and fulfillment, they will leave the company.</p>
                    <p><strong>The Drive to Defend</strong></p>
                    <p>The drive to defend is often the hardest lever to pull. This drive manifests itself as a quest to create and promote justice, fairness, and the ability to express ourselves freely. The organizational lever for this basic human motivator is resource allocation. This drive is also met through an employee feeling connection to a company. If their companies are merged with another, they will show worries.</p>
                    <p>Two studies have been done to find the relations between the four drives and motivation. The article based on two studies was finally published in Harvard Business Review. Most authors' arguments have laid emphasis on four-drive theory and actual investigations. Using the results of the surveys which executed with employees from Fortune 500 companies and other two global businesses (P company and H company), the article mentions about how independent drives influence employees' behavior and how organizational levers boost employee motivation.</p>
                    <p>The studies show that the drive to bond is most related to fulfilling commitment, while the drive to comprehend is most related to how much effort employees spend on works. The drive to acquire can be satisfied by a rewarding system which ties rewards to performances, and gives the best people opportunities for advancement. For drive to defend, a study on the merging of P company and H company shows that employees in former company show an unusual cooperating attitude.</p>
                    <p>The key to successfully motivate employees is to meet all drives. Each of these drives is important if we are to understand employee motivation. These four drives, while not necessarily the only human drives, are the ones that are central to unified understanding of modern human life.</p>
                </div>
            </div>
            <div class="resizer" id="resizer"></div>
            <div class="questions-panel" id="questions-panel">
                <div id="questions-1" class="question-set">
                    <div class="questions-container">
                        <div class="question" data-q-start="1" data-q-end="5">
                            <div class="question-prompt">
                                <p><strong>Questions 1-5</strong></p>
                                <p>Complete the notes below. Write <strong>NO MORE THAN TWO WORDS</strong> from the text for each answer.</p>
                            </div>
                            <div class="summary-text">
                                <p><strong>Forest fire ensures that:</strong></p>
                                <p>Birds can locate their <input type="text" class="answer-input" id="q1" placeholder="1"> in the ground.</p>
                                <p>The burrows of a species of <input type="text" class="answer-input" id="q2" placeholder="2"> provide homes to many other animals.</p>
                                <p>Hardwoods such as <input type="text" class="answer-input" id="q3" placeholder="3"> can grow and outnumber long-leaf trees.</p>
                                <p><strong>Apart from fires lit by lightning:</strong></p>
                                <p>Fires are created by <input type="text" class="answer-input" id="q4" placeholder="4"> and settlers.</p>
                                <p>Fires deliberately lit are called <input type="text" class="answer-input" id="q5" placeholder="5">.</p>
                                </div>
                            </div>

                        <div class="question" data-q-start="6" data-q-end="9">
                            <div class="question-prompt">
                                <p><strong>Questions 6-9</strong></p>
                                <p>Complete the flow-chart below. Writer <strong>ONE WORD ONLY</strong> from the text for each answer.</p>
                            </div>
                            <div class="flow-chart">
                                <div class="flow-title">How to increase the number of cockaded woodpeckers</div>
                                
                                <div class="flow-step">
                                    Calcium stored in 6 <input type="text" class="answer-input" id="q6" placeholder="6">
                                </div>
                                
                                <div class="flow-arrow">↓</div>
                                
                                <div class="flow-step">
                                    Shrubs are burned
                                </div>
                                
                                <div class="flow-arrow">↓</div>
                                
                                <div class="flow-step input-step">
                                    Calcium released into 7 <input type="text" class="answer-input" id="q7" placeholder="7">
                                </div>
                                
                                <div class="flow-arrow">↓</div>
                                
                                <div class="flow-step">
                                    Travel up to the leaves
                                </div>
                                
                                <div class="flow-arrow">↓</div>
                                
                                <div class="flow-step input-step">
                                    8 <input type="text" class="answer-input" id="q8" placeholder="8"> are eaten
                                </div>
                                
                                <div class="flow-arrow">↓</div>
                                
                                <div class="flow-step input-step">
                                    Number of 9 <input type="text" class="answer-input" id="q9" placeholder="9"> increases
                                </div>
                                
                                <div class="flow-arrow">↓</div>
                                
                                <div class="flow-step">
                                    More cockaded woodpeckers
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="10" data-q-end="13">
                            <div class="question-prompt">
                                <p><strong>Questions 10-13</strong></p>
                                <p>Do the following statements agree with the information given in the text?</p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li><strong>TRUE</strong> if the statement agrees with the information</li>
                                    <li><strong>FALSE</strong> if the statement contradicts the information</li>
                                    <li><strong>NOT GIVEN</strong> if there is no information on this</li>
                                </ul>
                            </div>
                            <div class="tf-question" data-q-start="10" data-q-end="10">
                                <div class="tf-question-line"><span class="tf-question-number">10</span><span class="tf-question-text">The sparse distribution of longleaf pine trees leads to the most diversity of species.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q10" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q10" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q10" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="11" data-q-end="11">
                                <div class="tf-question-line"><span class="tf-question-number">11</span><span class="tf-question-text">It is easier to restore forests converted to farms than forests converted to plantations.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q11" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q11" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q11" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="12" data-q-end="12">
                                <div class="tf-question-line"><span class="tf-question-number">12</span><span class="tf-question-text">The cost to restore forest is increasing recently.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q12" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q12" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q12" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="13" data-q-end="13">
                                <div class="tf-question-line"><span class="tf-question-number">13</span><span class="tf-question-text">Few can live to see the replanted forest reach its maturity.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q13" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q13" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q13" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                        </div>
                            </div>
                                </div>
                <div id="questions-2" class="question-set hidden">
                    <div class="questions-container">
                        <div class="question" data-q-start="14" data-q-end="20">
                            <div class="question-prompt">
                                <p><strong>Questions 14-20</strong></p>
                                <p>The text has seven paragraphs. Choose the correct heading for each section and move it into the gap.</p>
                            </div>
                            <div class="heading-options-container">
                                <p><strong>List of Headings</strong></p>
                                <div class="heading-drag-item" draggable="true" data-heading="i" ondragstart="drag(event)">i. The positive correlation between climate and wealth</div>
                                <div class="heading-drag-item" draggable="true" data-heading="ii" ondragstart="drag(event)">ii. Other factors besides climate that influence wealth</div>
                                <div class="heading-drag-item" draggable="true" data-heading="iii" ondragstart="drag(event)">iii. Inspiration from reading a book</div>
                                <div class="heading-drag-item" draggable="true" data-heading="iv" ondragstart="drag(event)">iv. Other researchers' results do not rule out exceptional cases</div>
                                <div class="heading-drag-item" draggable="true" data-heading="v" ondragstart="drag(event)">v. Different attributes between Eurasia and Africa</div>
                                <div class="heading-drag-item" draggable="true" data-heading="vi" ondragstart="drag(event)">vi. Low temperature benefits people and crops</div>
                                <div class="heading-drag-item" draggable="true" data-heading="vii" ondragstart="drag(event)">vii. The importance of institution in traditional views</div>
                                <div class="heading-drag-item" draggable="true" data-heading="viii" ondragstart="drag(event)">viii. The spread of crops in Europe, Asia and other places</div>
                                <div class="heading-drag-item" draggable="true" data-heading="ix" ondragstart="drag(event)">ix. The best way to use aid</div>
                                <div class="heading-drag-item" draggable="true" data-heading="x" ondragstart="drag(event)">x. Confusions and exceptions</div>
                            </div>
                            
                            <!-- Hidden inputs for tracking answers -->
                            <div style="display: none;">
                                <input type="text" id="q14" value="">
                                <input type="text" id="q15" value="">
                                <input type="text" id="q16" value="">
                                <input type="text" id="q17" value="">
                                <input type="text" id="q18" value="">
                                <input type="text" id="q19" value="">
                                <input type="text" id="q20" value="">
                            </div>
                        </div>

                        <div class="question" data-q-start="21" data-q-end="26">
                            <div class="question-prompt">
                                <p><strong>Questions 21-26</strong></p>
                                <p>Complete the summary below. Write <strong>NO MORE THAN TWO WORDS</strong> from the text for each answer.</p>
                            </div>
                            <div class="summary-text">
                                <p>Dr William Masters read a book saying that a(an) <input type="text" class="answer-input" id="q21" placeholder="21"> epidemic which struck an American city hundreds of years ago was terminated by a cold frost. And academics found that there is a connection between climate and country's wealth as in the rich but small country of <input type="text" class="answer-input" id="q22" placeholder="22">. Yet besides excellent surroundings and climate, one country still needs to improve their <input type="text" class="answer-input" id="q23" placeholder="23"> to achieve long prosperity.</p>
                                <p>Thanks to resembling weather conditions across latitude in the continent of <input type="text" class="answer-input" id="q24" placeholder="24">, crops such as <input type="text" class="answer-input" id="q25" placeholder="25"> is bound to spread faster than from South America to the North. Other researchers also noted that even though geographical factors are important, tropical country such as <input type="text" class="answer-input" id="q26" placeholder="26"> still became rich due to scientific advancement.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="questions-3" class="question-set hidden">
                    <div class="questions-container">
                        <div class="question" data-q-start="27" data-q-end="31">
                            <div class="question-prompt">
                                <p><strong>Questions 27-31</strong></p>
                                <p>Choose the correct answer.</p>
                            </div>
                            <div class="multi-choice-question" data-q-start="27" data-q-end="27">
                                <div class="question-prompt">
                                    <p><strong>27.</strong> According to the passage, what are we told about the study of motivation?</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q27" value="A"> The theory of motivating employees is starting to catch attention in organizations in recent years.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q27" value="B"> It is very important for managers to know how to motivate their subordinates because it is related to the salary of employees.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q27" value="C"> Researchers have tended to be too theoretical to their study.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q27" value="D"> The goal of employee motivation is to increase the profit of organizations.</label></div>
                            </div>
                            <div class="multi-choice-question" data-q-start="28" data-q-end="28">
                                <div class="question-prompt">
                                    <p><strong>28.</strong> What can be inferred from the passage about the study of people's drives?</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q28" value="A"> Satisfying employees' drives can positively lead to the change of behavior.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q28" value="B"> Satisfying employees' drives will negatively affect their emotions.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q28" value="C"> Satisfying employees' drives can increase companies' productions.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q28" value="D"> Satisfying employees' drives will result in employees' outstanding performance.</label></div>
                            </div>
                            <div class="multi-choice-question" data-q-start="29" data-q-end="29">
                                <div class="question-prompt">
                                    <p><strong>29.</strong> According to paragraph three, in order to optimize employees' performance, _________ are needed.</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q29" value="A"> Drive to acquire and achievement element</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q29" value="B"> Outstanding performance and recognition</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q29" value="C"> Career fulfillment and a thousand dollar check</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q29" value="D"> Financial incentive and recognition</label></div>
                            </div>
                            <div class="multi-choice-question" data-q-start="30" data-q-end="30">
                            <div class="question-prompt">
                                    <p><strong>30.</strong> According to paragraph five, how does "the drive to comprehend" help employees perform better?</p>
                            </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q30" value="A"> It can help employees better understand the development of their organizations.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q30" value="B"> It can help employees feel their task in meaningful to their companies.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q30" value="C"> It can help employees set higher goals.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q30" value="D"> It can provide employees with repetitive tasks.</label></div>
                                </div>
                            <div class="multi-choice-question" data-q-start="31" data-q-end="31">
                                <div class="question-prompt">
                                    <p><strong>31.</strong> According to paragraph six, which of following is true about "drive to defend"?</p>
                            </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q31" value="A"> Organizational resource is the most difficult to allocate.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q31" value="B"> It is more difficult to implement than the drive to comprehend.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q31" value="C"> Employees think it is very important to voice their own opinions.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q31" value="D"> Employees think it is very important to connect with a merged corporation.</label></div>
                    </div>
                </div>

                        <div class="question" data-q-start="32" data-q-end="34">
                            <div class="question-prompt">
                                <p><strong>Questions 32-34</strong></p>
                                <p>Choose <strong>THREE</strong> correct answers.</p><br>
                                <p><strong>32-34</strong>&nbsp;&nbsp;Which <strong>THREE</strong> of the following statements are true of study of drives?</p>
                            </div>
                            <div class="multi-choice-question" data-q-start="32" data-q-end="34">
                                <div class="multi-choice-option"><label><input type="checkbox" name="q32A" value="A"> Employees will be motivated if they feel belonged to the company.</label></div>
                                <div class="multi-choice-option"><label><input type="checkbox" name="q32B" value="B"> If employees get an opportunity of training and development program, their motivation will be enhanced.</label></div>
                                <div class="multi-choice-option"><label><input type="checkbox" name="q32C" value="C"> If employees' working goals are complied with organizational objectives, their motivation will be reinforced.</label></div>
                                <div class="multi-choice-option"><label><input type="checkbox" name="q32D" value="D"> If employees' motivation is very low, companies should find a way to increase their salary as their first priority.</label></div>
                                <div class="multi-choice-option"><label><input type="checkbox" name="q32E" value="E"> If employees find their work lacking challenging, they will leave the company.</label></div>
                                <div class="multi-choice-option"><label><input type="checkbox" name="q32F" value="F"> Employees will worry if their company is sold.</label></div>
                            </div>
                        </div>

                        <div class="question" data-q-start="35" data-q-end="40">
                            <div class="question-prompt">
                                <p><strong>Questions 35-40</strong></p>
                                <p>Do the following statements agree with the claims of the writer in Reading Passage 3?</p>
                                <p>In boxes 35-40 on your answer sheet, write</p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li><strong>YES</strong> if the statement agree with the claims of the writer</li>
                                    <li><strong>NO</strong> if the statement contradicts the claims of the writer</li>
                                    <li><strong>NOT GIVEN</strong> if it is impossible to say what the writer thinks about this</li>
                                </ul>
                                    </div>
                            <div class="tf-question" data-q-start="35" data-q-end="35">
                                <div class="tf-question-line"><span class="tf-question-number">35</span><span class="tf-question-text">Increasing pay can lead to the high work motivation.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q35" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q35" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q35" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="36" data-q-end="36">
                                <div class="tf-question-line"><span class="tf-question-number">36</span><span class="tf-question-text">Local companies benefit more from global companies through the study.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q36" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q36" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q36" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="37" data-q-end="37">
                                <div class="tf-question-line"><span class="tf-question-number">37</span><span class="tf-question-text">Employees achieve the most commitment if their drive to comprehend is met.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q37" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q37" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q37" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="38" data-q-end="38">
                                <div class="tf-question-line"><span class="tf-question-number">38</span><span class="tf-question-text">The employees in former company presented unusual attitude toward the merging of two companies.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q38" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q38" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q38" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="39" data-q-end="39">
                                <div class="tf-question-line"><span class="tf-question-number">39</span><span class="tf-question-text">The two studies are done to analyze the relationship between the natural drives and the attitude of employees.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q39" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q39" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q39" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="40" data-q-end="40">
                                <div class="tf-question-line"><span class="tf-question-number">40</span><span class="tf-question-text">Rewarding system cause the company to lose profit.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q40" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q40" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q40" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                        </div>
        </div>
    </div>

    <!-- Navigation Arrows -->
    <div class="nav-arrows">
        <button class="nav-arrow prev" onclick="previousQuestion()" id="prevBtn" aria-label="Previous question">
            <!-- Left arrow icon -->
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <button class="nav-arrow next" onclick="nextQuestion()" id="nextBtn" aria-label="Next question">
            <!-- Right arrow icon -->
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav-row perScorableItem" aria-label="Questions">
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(1)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">1</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(1)"><span class="sr-only">Question 1</span><span aria-hidden="true">1</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(2)"><span class="sr-only">Question 2</span><span aria-hidden="true">2</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(3)"><span class="sr-only">Question 3</span><span aria-hidden="true">3</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(4)"><span class="sr-only">Question 4</span><span aria-hidden="true">4</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(5)"><span class="sr-only">Question 5</span><span aria-hidden="true">5</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(6)"><span class="sr-only">Question 6</span><span aria-hidden="true">6</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(7)"><span class="sr-only">Question 7</span><span aria-hidden="true">7</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(8)"><span class="sr-only">Question 8</span><span aria-hidden="true">8</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(9)"><span class="sr-only">Question 9</span><span aria-hidden="true">9</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(10)"><span class="sr-only">Question 10</span><span aria-hidden="true">10</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(11)"><span class="sr-only">Question 11</span><span aria-hidden="true">11</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(12)"><span class="sr-only">Question 12</span><span aria-hidden="true">12</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(13)"><span class="sr-only">Question 13</span><span aria-hidden="true">13</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 selected multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(2)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">2</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(14)"><span class="sr-only">Question 14</span><span aria-hidden="true">14</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(15)"><span class="sr-only">Question 15</span><span aria-hidden="true">15</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(16)"><span class="sr-only">Question 16</span><span aria-hidden="true">16</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(17)"><span class="sr-only">Question 17</span><span aria-hidden="true">17</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(18)"><span class="sr-only">Question 18</span><span aria-hidden="true">18</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(19)"><span class="sr-only">Question 19</span><span aria-hidden="true">19</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(20)"><span class="sr-only">Question 20</span><span aria-hidden="true">20</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(21)"><span class="sr-only">Question 21</span><span aria-hidden="true">21</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(22)"><span class="sr-only">Question 22</span><span aria-hidden="true">22</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(23)"><span class="sr-only">Question 23</span><span aria-hidden="true">23</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(24)"><span class="sr-only">Question 24</span><span aria-hidden="true">24</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(25)"><span class="sr-only">Question 25</span><span aria-hidden="true">25</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(26)"><span class="sr-only">Question 26</span><span aria-hidden="true">26</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(3)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">3</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 14</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(27)"><span class="sr-only">Question 27</span><span aria-hidden="true">27</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(28)"><span class="sr-only">Question 28</span><span aria-hidden="true">28</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(29)"><span class="sr-only">Question 29</span><span aria-hidden="true">29</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(30)"><span class="sr-only">Question 30</span><span aria-hidden="true">30</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(31)"><span class="sr-only">Question 31</span><span aria-hidden="true">31</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(32)"><span class="sr-only">Question 32</span><span aria-hidden="true">32</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(33)"><span class="sr-only">Question 33</span><span aria-hidden="true">33</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(34)"><span class="sr-only">Question 34</span><span aria-hidden="true">34</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(35)"><span class="sr-only">Question 35</span><span aria-hidden="true">35</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(36)"><span class="sr-only">Question 36</span><span aria-hidden="true">36</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(37)"><span class="sr-only">Question 37</span><span aria-hidden="true">37</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(38)"><span class="sr-only">Question 38</span><span aria-hidden="true">38</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(39)"><span class="sr-only">Question 39</span><span aria-hidden="true">39</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(40)"><span class="sr-only">Question 40</span><span aria-hidden="true">40</span></button>
            </div>
        </div>
        
    </nav>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div id="menu-highlight" class="context-menu-item" onclick="highlightText()">
            Highlight
        </div>
        <div id="menu-note" class="context-menu-item" onclick="addNote()">
            Note
        </div>
        <div id="menu-clear" class="context-menu-item" onclick="clearHighlight()">
            Clear
        </div>
        <div id="menu-clear-all" class="context-menu-item" onclick="clearAllHighlights()">
            Clear All
        </div>
    </div>

    <div id="results-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeResultsModal()">&times;</button>
            <h2>Results</h2>
            <div class="results-summary">
                <p>Score: <span id="results-score"></span> / 40</p>
                <p>IELTS Band: <span id="results-band"></span></p>
            </div>
            <div id="results-details" class="results-details-container">
                <!-- Results for each question will be injected here -->
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- STATE VARIABLES ---
        let currentPassage = 1;
        let currentQuestion = 1;
        let selectedRange = null;
        let timeInSeconds = 3600;
        let timerInterval;
        let draggedItem = null;
        let activeQuestionElement = null;
        let selectedDragItem = null;

        // --- GLOBAL FUNCTIONS ---
        function getFirstQuestionOfPart(part) {
            switch(part) {
                case 1: return 1;
                case 2: return 14;
                case 3: return 27;
                default: return 1;
            }
        }

        // --- DOM ELEMENTS ---
        const timerDisplay = document.querySelector('.timer-display');
        const timerToggleButton = document.getElementById('timer-toggle-btn');
        const timerResetButton = document.getElementById('timer-reset-btn');
        const deliverButton = document.getElementById('deliver-button');
        const resizer = document.getElementById('resizer');
        const passagePanel = document.getElementById('passage-panel');
        const questionsPanel = document.getElementById('questions-panel');
        const contextMenu = document.getElementById('contextMenu');

        // --- ICON SVGs ---
        const playIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>';
        const pauseIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';

        // --- ANSWERS ---
        const correctAnswers = {
            // Part 1 (1-13) - Foot Pedal Irrigation
            '1': 'nest',
            '2': 'tortoises',
            '3': 'oaks',
            '4': 'Native Americans',
            '5': 'prescribed burns',
            '6': 'shrubs',
            '7': 'soil',
            '8': 'ant',
            '9': 'eggs',
            '10': 'TRUE',
            '11': 'FALSE',
            '12': 'NOT GIVEN',
            '13': 'TRUE',
            // Part 2 (14-26) - Coastal Archaeology of Britain
            '14': 'iii',
            '15': 'vi',
            '16': 'i',
            '17': 'ii',
            '18': 'ix',
            '19': 'v',
            '20': 'iv',
            '21': 'yellow fever',
            '22': 'Finland',
            '23': ['institutions', 'governments'],
            '24': 'Europe',
            '25': 'einkorn wheat',
            '26': 'Singapore',
            // Part 3 (27-40) - Biology of Bitterness
            '27': 'C',
            '28': 'A',
            '29': 'D',
            '30': 'B',
            '31': 'C',
            '32-34': 'A, E, F',
            '35': 'NO',
            '36': 'NOT GIVEN',
            '37': 'NO',
            '38': 'YES',
            '39': 'NO',
            '40': 'NOT GIVEN'
        };

        // --- INITIALIZATION ---
        function initialize() {
            console.log(`🚀 Initializing application...`);
            startTimer();
            initializeDragAndDrop();
            setupCheckboxLimits();
            setupExampleHeading();
            console.log(`📋 Setting up initial state - switching to part 1`);
            switchToPart(1); // Also calls goToQuestion(1) and updateNavigation
            
            document.body.addEventListener('input', updateAllIndicators);
            document.body.addEventListener('change', updateAllIndicators);
            deliverButton.addEventListener('click', checkAnswers);
            timerToggleButton.addEventListener('click', toggleTimer);
            timerResetButton.addEventListener('click', resetTimer);

            // Auto-close dropdowns for Questions 14-17 on selection
            ['q14','q15','q16','q17'].forEach(id => {
                const sel = document.getElementById(id);
                if (sel) {
                    sel.addEventListener('change', () => sel.blur());
                }
            });

            // Add click listeners to question containers for navigation
            document.querySelectorAll('[data-q-start]').forEach(el => {
                el.addEventListener('click', (event) => {
                    // Stop event propagation to prevent parent container clicks
                    event.stopPropagation();
                    
                    const qNum = parseInt(el.dataset.qStart, 10);
                    const qEnd = parseInt(el.dataset.qEnd, 10);
                    
                    console.log(`🖱️ Question container clicked - qNum: ${qNum}, qEnd: ${qEnd}, currentQuestion: ${currentQuestion}, element:`, el);
                    
                    // Handle cases where qNum is NaN
                    if (isNaN(qNum)) {
                        console.log(`ℹ️ Container without valid question number, ignoring navigation`);
                        return;
                    }
                    
                    // Only navigate if this is a single question (qStart === qEnd) or if we're clicking on a specific question within a group
                    if (qNum === qEnd || el.classList.contains('tf-question')) {
                        if (currentQuestion !== qNum) {
                            console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum}`);
                            goToQuestion(qNum);
                        } else {
                            console.log(`ℹ️ Already on question ${qNum}, no navigation needed`);
                        }
                    } else {
                        console.log(`ℹ️ Ignoring click on group container (${qNum}-${qEnd})`);
                    }
                });
            });
            
            // Add specific click listeners for individual question elements to prevent parent container interference
            document.querySelectorAll('.tf-question, .summary-text').forEach(el => {
                el.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const qNum = parseInt(el.dataset.qStart, 10);
                    console.log(`🎯 Individual question element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, element:`, el);
                    
                    // Handle cases where qNum is NaN (like .summary-text containers)
                    if (isNaN(qNum)) {
                        console.log(`ℹ️ Container without specific question number, ignoring navigation`);
                        return;
                    }
                    
                    if (currentQuestion !== qNum) {
                        console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (individual element)`);
                        goToQuestion(qNum);
                    } else {
                        console.log(`ℹ️ Already on question ${qNum}, no navigation needed (individual element)`);
                    }
                });
            });
            
            // Add specific click listeners for individual input elements in questions 33-36
            document.querySelectorAll('.answer-input[id^="q3"]').forEach(input => {
                input.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const qNum = parseInt(input.id.replace('q', ''), 10);
                    console.log(`📝 Input element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, input:`, input);
                    
                    if (currentQuestion !== qNum) {
                        console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (input element)`);
                        goToQuestion(qNum);
                    } else {
                        console.log(`ℹ️ Already on question ${qNum}, no navigation needed (input element)`);
                    }
                });
            });
            
            // Add click listeners for the paragraph elements containing questions 33-36
            document.querySelectorAll('.summary-text p').forEach(p => {
                p.addEventListener('click', (event) => {
                    event.stopPropagation();
                    // Extract question number from the paragraph text (e.g., "33" from "<strong>33</strong>")
                    const strongElement = p.querySelector('strong');
                    if (strongElement) {
                        const qNum = parseInt(strongElement.textContent, 10);
                        console.log(`📄 Summary paragraph clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, paragraph:`, p);
                        
                        if (!isNaN(qNum) && currentQuestion !== qNum) {
                            console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (summary paragraph)`);
                            goToQuestion(qNum);
                        } else if (!isNaN(qNum)) {
                            console.log(`ℹ️ Already on question ${qNum}, no navigation needed (summary paragraph)`);
                        }
                    }
                });
            });

            resizer.addEventListener('mousedown', initResize, false);
            initializeContextMenu();
        }

        // --- CORE TEST LOGIC ---

        function checkAnswers() {
            // Disable all inputs to prevent changes
            const allInputs = document.querySelectorAll('input, select, textarea');
            allInputs.forEach(input => {
                input.disabled = true;
            });

            // Disable all drag and drop functionality
            document.querySelectorAll('.drag-item').forEach(item => {
                item.setAttribute('draggable', 'false');
                item.style.cursor = 'not-allowed';
                item.style.pointerEvents = 'none';
            });

            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.style.pointerEvents = 'none';
                zone.classList.add('disabled');
            });

            // Disable submit button
            deliverButton.disabled = true;
            deliverButton.style.cursor = 'not-allowed';
            
            clearInterval(timerInterval);
            let score = 0;
            const totalQuestions = 40;
            const resultsDetailsContainer = document.getElementById('results-details');
            resultsDetailsContainer.innerHTML = '';

            document.querySelectorAll('.correct, .incorrect, .correct-answer-highlight').forEach(el => {
                el.classList.remove('correct', 'incorrect', 'correct-answer-highlight');
            });
            document.querySelectorAll('.correct-answer-display').forEach(el => el.remove());

            // Helper to evaluate the special TWO-answers checkbox group (Q20 & Q21) - only if present
            const hasQ20to21Group = document.querySelectorAll('input[name="q20-21"]').length > 0;
            function evaluateQ20to21() {
                const checked = Array.from(document.querySelectorAll('input[name="q20-21"]:checked')).map(el => el.value).sort();
                const isCorrect20 = checked.includes('A');
                const isCorrect21 = checked.includes('E');

                // Mark selected labels
                document.querySelectorAll('input[name="q20-21"]').forEach(input => {
                    const label = input.closest('.multi-choice-option');
                    if (!label) return;
                    label.classList.remove('correct', 'incorrect', 'correct-answer-highlight');
                    if (input.checked) {
                        const good = (input.value === 'A' && isCorrect20) || (input.value === 'E' && isCorrect21);
                        label.classList.add(good ? 'correct' : 'incorrect');
                    }
                    if (!isCorrect20 && input.value === 'A') label.classList.add('correct-answer-highlight');
                    if (!isCorrect21 && input.value === 'E') label.classList.add('correct-answer-highlight');
                });

                const selectedText = checked.join(' & ') || 'Not Answered';
                // Q20 row
                resultsDetailsContainer.innerHTML += `
                    <div class="result-row ${isCorrect20 ? '' : 'incorrect'}">
                        <span class="q-num">20</span>
                        <span class="user-ans">${selectedText}</span>
                        <span class="correct-ans">A</span>
                    </div>`;
                // Q21 row
                resultsDetailsContainer.innerHTML += `
                    <div class="result-row ${isCorrect21 ? '' : 'incorrect'}">
                        <span class="q-num">21</span>
                        <span class="user-ans">${selectedText}</span>
                        <span class="correct-ans">E</span>
                    </div>`;

                // Mark nav buttons
                const nav20 = document.querySelector(`.subQuestion[onclick="goToQuestion(20)"]`);
                if (nav20) { nav20.classList.remove('answered', 'active'); nav20.classList.add(isCorrect20 ? 'correct' : 'incorrect'); }
                const nav21 = document.querySelector(`.subQuestion[onclick="goToQuestion(21)"]`);
                if (nav21) { nav21.classList.remove('answered', 'active'); nav21.classList.add(isCorrect21 ? 'correct' : 'incorrect'); }

                if (isCorrect20) score += 1;
                if (isCorrect21) score += 1;
                return (isCorrect20 || isCorrect21);
            }

            let q20to21Evaluated = false;
            for (let i = 1; i <= totalQuestions; i++) {
                const questionKey = String(i);
                const correctAnswer = correctAnswers[questionKey];
                let userAnswer = '';
                let isCorrect = false;
                
                let userAnswerDisplay = 'Not Answered';
                const correctAnswerText = Array.isArray(correctAnswer) ? correctAnswer.join(' / ') : correctAnswer;

                // Special handling: combined checkbox group for Q20 & Q21
                if ((i === 20 || i === 21) && hasQ20to21Group) {
                    if (!q20to21Evaluated) {
                        evaluateQ20to21();
                        q20to21Evaluated = true;
                    }
                    continue; // Already handled rows, scoring, and marking
                }

                const textInput = document.getElementById(`q${i}`);
                const radioGroup = document.querySelectorAll(`input[name="q${i}"][type="radio"]`);
                
                // Handle Text and Select Inputs
                if (textInput && (textInput.tagName === 'INPUT' || textInput.tagName === 'SELECT')) {
                    const element = textInput.closest('.matching-form-row') || textInput;
                    userAnswer = textInput.value.trim();
                    userAnswerDisplay = userAnswer || 'Not Answered';

                    const normalize = (s) => (s || '')
                        .toString()
                        .toLowerCase()
                        .replace(/[^a-z0-9\s]/g, '')
                        .replace(/\s+/g, ' ')
                        .trim();

                    if (textInput.tagName === 'SELECT') {
                        isCorrect = userAnswer === correctAnswer;
                    } else {
                        const normUser = normalize(userAnswer);
                        if (Array.isArray(correctAnswer)) {
                            isCorrect = correctAnswer.some(ans => normalize(ans) === normUser);
                        } else {
                            isCorrect = normalize(correctAnswer) === normUser;
                        }
                    }

                    // Special visual handling for Paragraph Headings (Q14–20): mark the visible drop-zones
                    const isHeadingQuestion = i >= 14 && i <= 20;
                    let targetForMarking = element;
                    if (isHeadingQuestion) {
                        const letters = ['A','B','C','D','E','F','G'];
                        const paragraphLetter = letters[i - 14];
                        const dropZone = document.querySelector(`.paragraph-drop-zone[data-paragraph="${paragraphLetter}"]`);
                        if (dropZone) {
                            targetForMarking = dropZone;
                            // For Questions 14-20, check the actual dropped answer in the drop zone
                            const droppedAnswer = dropZone.getAttribute('data-answer');
                            console.log(`🔍 Checking Questions 14-20: Question ${i}, Paragraph ${paragraphLetter}, DropZone:`, dropZone);
                            console.log(`🔍 Dropped answer: "${droppedAnswer}", Correct answer: "${correctAnswer}"`);
                            if (droppedAnswer) {
                                userAnswer = droppedAnswer;
                                userAnswerDisplay = droppedAnswer;
                                isCorrect = droppedAnswer === correctAnswer;
                                console.log(`✅ Question ${i}: User answer "${droppedAnswer}", Correct: ${isCorrect}`);
                            } else {
                                // No answer provided for Questions 14-20
                                userAnswer = '';
                                userAnswerDisplay = 'Not Answered';
                                isCorrect = false;
                                console.log(`⚠️ Question ${i}: No answer provided, marking as incorrect`);
                            }
                        }
                    }
                    
                    if (isCorrect) {
                        score++;
                        targetForMarking.classList.add('correct');
                        console.log(`✅ Question ${i} is correct! Added 'correct' class to:`, targetForMarking);
                    } else {
                        targetForMarking.classList.add('incorrect');
                        console.log(`❌ Question ${i} is incorrect! Added 'incorrect' class to:`, targetForMarking);
                        // Show correct answer hint next to the visible element if available
                        const correctAnswerSpan = document.createElement('span');
                        correctAnswerSpan.className = 'correct-answer-display';
                        correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswerText}</span>`;
                        if (targetForMarking !== element) {
                            targetForMarking.appendChild(correctAnswerSpan);
                        } else {
                            textInput.parentNode.insertBefore(correctAnswerSpan, textInput.nextSibling);
                        }
                    }
                }
                // Handle drag and drop questions (any with a drop-zone for this question)
                else if (document.querySelector(`.drop-zone[data-q-start="${i}"]`)) {
                    console.log(`🔍 Checking drag-and-drop question ${i}`);
                    const dropZone = document.querySelector(`.drop-zone[data-q-start="${i}"]`);
                    const droppedItem = dropZone ? dropZone.querySelector('.drag-item') : null;
                    
                    console.log(`📍 Drop zone for question ${i}:`, dropZone);
                    console.log(`📍 Dropped item for question ${i}:`, droppedItem);
                    console.log(`📍 Correct answer for question ${i}:`, correctAnswer);
                    
                    if (droppedItem) {
                        userAnswer = droppedItem.dataset.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        // Mark the drop zone as correct or incorrect
                        dropZone.classList.add(isCorrect ? 'correct' : 'incorrect');
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                        
                        // Show correct answer if wrong
                        if (!isCorrect && correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    } else {
                        // No answer provided - mark as incorrect
                        console.log(`⚠️ No answer provided for question ${i}`);
                        if (dropZone) {
                            dropZone.classList.add('incorrect');
                        }
                        if (correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    }
                }
                // Handle Radio Button Inputs (T/F, MCQs)
                else if (radioGroup.length > 0) {
                    const questionContainer = radioGroup[0]?.closest('.tf-question') || radioGroup[0]?.closest('.multi-choice-question');
                    const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);

                    if (checkedRadio) {
                        userAnswer = checkedRadio.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;

                        const userLabel = checkedRadio.closest('.tf-option, .multi-choice-option');
                        if (userLabel) {
                            userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                        
                        // Handle table radio buttons
                        if (checkedRadio.classList.contains('table-radio')) {
                            const tableCell = checkedRadio.closest('td');
                            if (tableCell) {
                                tableCell.classList.add(isCorrect ? 'correct' : 'incorrect');
                            }
                        }
                    }

                    if (isCorrect) {
                        score++;
                    } else {
                        if (questionContainer){
                            const correctOptionEl = questionContainer.querySelector(`input[name="q${i}"][value="${correctAnswerText}"]`);
                            if (correctOptionEl) {
                                const correctLabel = correctOptionEl.closest('.tf-option, .multi-choice-option');
                                if (correctLabel) {
                                    correctLabel.classList.add('correct-answer-highlight');
                                }
                            }
                        }
                    }
                }
                // Questions 24-26 are text input questions (completing a summary), not checkboxes
                // They are handled by the normal text input logic above
                // Handle checkboxes for questions 32-34 as a single group
                else if (i === 32) {
                    console.log(`🔍 Checking checkbox group questions 32-34`);
                    const checked = document.querySelectorAll('input[name^="q32"]:checked');
                    const selectedValues = Array.from(checked).map(cb => cb.value).sort();
                    if (selectedValues.length > 0) {
                        userAnswer = selectedValues.join(', ');
                        userAnswerDisplay = userAnswer;
                        const correctValues = ['A', 'E', 'F'];
                        const numCorrect = selectedValues.filter(v => correctValues.includes(v)).length;
                        isCorrect = numCorrect === 3;
                        score += numCorrect; // 1 point per correct selection

                        // Mark selected options
                        checked.forEach(cb => {
                            const parent = cb.closest('.multi-choice-option');
                            if (parent) parent.classList.add(correctValues.includes(cb.value) ? 'correct' : 'incorrect');
                        });

                        // Highlight missed correct answers
                        if (!isCorrect) {
                            correctValues.filter(v => !selectedValues.includes(v)).forEach(val => {
                                const cb = document.querySelector(`input[name^="q32"][value="${val}"]`);
                                if (cb) {
                                    const parent = cb.closest('.multi-choice-option');
                                    if (parent) parent.classList.add('correct-answer-highlight');
                                }
                            });
                        }
                    } else {
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // Handle clickable-cell matrix questions (generic for any i that has clickable cells)
                else if (document.querySelector(`.clickable-cell[data-question="${i}"]`)) {
                    console.log(`🔍 Checking clickable cell question ${i}`);
                    const selectedCell = document.querySelector(`.clickable-cell[data-question="${i}"][data-selected="true"]`);
                    console.log(`📍 Selected cell for question ${i}:`, selectedCell);
                    console.log(`📍 Correct answer for question ${i}:`, correctAnswer);
                    
                    if (selectedCell) {
                        userAnswer = selectedCell.dataset.answer;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        selectedCell.classList.add(isCorrect ? 'correct' : 'incorrect');
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                    
                    // Handle highlighting correct answers for incorrect responses
                    if (!isCorrect) {
                        const correctCell = document.querySelector(`.clickable-cell[data-question="${i}"][data-value="${correctAnswerText}"]`);
                        if (correctCell) {
                            correctCell.classList.add('correct-answer-highlight');
                            console.log(`✅ Highlighted correct answer for question ${i}:`, correctCell);
                        } else {
                            console.log(`⚠️ Could not find correct cell for question ${i} with value "${correctAnswerText}"`);
                        }
                    }
                }
                // Handle text input questions (33-39)
                else if (i >= 33 && i <= 39) {
                    console.log(`🔍 Checking text input question ${i}`);
                    const textInput = document.getElementById(`q${i}`);
                    
                    if (textInput) {
                        userAnswer = textInput.value.trim().toLowerCase();
                        userAnswerDisplay = userAnswer || 'Not Answered';
                        
                        // Handle special case for question 33 which has two answers
                        if (i === 33) {
                            const answers = userAnswer.split('&').map(ans => ans.trim());
                            isCorrect = answers.includes('breathing') && answers.includes('eating');
                        } else {
                            isCorrect = userAnswer === correctAnswer.toLowerCase();
                        }
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        if (isCorrect) {
                            score++;
                            textInput.classList.add('correct');
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            textInput.classList.add('incorrect');
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // Handle question 40 (multiple choice)
                else if (i === 40) {
                    console.log(`🔍 Checking multiple choice question ${i}`);
                    const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);
                    
                    if (checkedRadio) {
                        userAnswer = checkedRadio.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        const userLabel = checkedRadio.closest('.multi-choice-option');
                        if (userLabel) {
                            userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                            
                            // Highlight correct answer
                            const correctOptionEl = document.querySelector(`input[name="q${i}"][value="${correctAnswer}"]`);
                            if (correctOptionEl) {
                                const correctLabel = correctOptionEl.closest('.multi-choice-option');
                                if (correctLabel) {
                                    correctLabel.classList.add('correct-answer-highlight');
                                }
                            }
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // For showing results in the modal
                // Questions 24-26 are individual text input questions, not a checkbox group
                if (i !== 33 && i !== 34) {
                    // Show normal result for other questions
                 const resultRow = `
                    <div class="result-row ${isCorrect ? '' : 'incorrect'}">
                        <span class="q-num">${i}</span>
                        <span class="user-ans">${userAnswerDisplay}</span>
                        <span class="correct-ans">${correctAnswerText}</span>
                    </div>`;
                resultsDetailsContainer.innerHTML += resultRow;
                }
                // For 32-34 group, show a single row
                if (i === 32) {
                    const resultRow = `
                        <div class="result-row ${isCorrect ? '' : 'incorrect'}">
                            <span class="q-num">32-34</span>
                            <span class="user-ans">${userAnswerDisplay}</span>
                            <span class="correct-ans">A, E, F</span>
                        </div>`;
                    resultsDetailsContainer.innerHTML += resultRow;
                }
                
                // Update nav button color
                // Questions 24-26 are individual text input questions, not a checkbox group
                if (i !== 33 && i !== 34) {
                    // Update navigation button for other questions
                const navButton = document.querySelector(`.subQuestion[onclick="goToQuestion(${i})"]`);
                if (navButton) {
                    navButton.classList.remove('answered', 'active');
                    navButton.classList.add(isCorrect ? 'correct' : 'incorrect');
                    }
                }
                // Update nav buttons for 32-34 group as a whole
                if (i === 32) {
                    for (let q = 32; q <= 34; q++) {
                        const navButton = document.querySelector(`.subQuestion[onclick="goToQuestion(${q})"]`);
                        if (navButton) {
                            navButton.classList.remove('answered', 'active');
                            navButton.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                    }
                }
            }

            document.getElementById('results-score').textContent = score;
            document.getElementById('results-band').textContent = calculateBandScore(score);
            document.body.classList.add('results-mode');
            document.getElementById('results-modal').classList.remove('hidden');
            
            // Change button to "My Result" with green styling
            deliverButton.innerHTML = `<span>My Result</span>`;
            deliverButton.style.backgroundColor = '#4CAF50';
            deliverButton.style.color = 'white';
            deliverButton.style.borderColor = '#4CAF50';
            deliverButton.disabled = false;
            deliverButton.style.cursor = 'pointer';
            deliverButton.removeEventListener('click', checkAnswers);
            deliverButton.addEventListener('click', showResultsModal);
            
            // Highlight correct answers in the passage
            highlightCorrectAnswersInPassage();
        }

        function calculateBandScore(score) {
            if (score >= 39) return '9.0';
            const mapping = {
                40: 9.0, 39: 9.0, 38: 8.5, 37: 8.5, 36: 8.0, 35: 8.0, 34: 7.5,
                33: 7.5, 32: 7.0, 31: 7.0, 30: 7.0, 29: 6.5, 28: 6.5, 27: 6.5,
                26: 6.0, 25: 6.0, 24: 6.0, 23: 5.5, 22: 5.5, 21: 5.5, 20: 5.5,
                19: 5.0, 18: 5.0, 17: 5.0, 16: 5.0, 15: 5.0, 14: 4.5, 13: 4.5,
                12: 4.0, 11: 4.0, 10: 4.0, 9: 3.5, 8: 3.5, 7: 3.0, 6: 3.0,
                5: 2.5, 4: 2.5
            };
            if (score <= 0) return 0.0;
            if (score === 1) return 1.0;
            if (score <= 3) return 2.0;
            if (score <= 5) return 2.5;
            return mapping[score] || 0.0;
        }

        function highlightCorrectAnswersInPassage() {
            // Define the text passages and their corresponding question numbers for Part 1 (Foot Pedal Irrigation)
            const part1Highlights = [
                { question: 1, text: "large-scale projects: gigantic dams, sprawling, irrigation canals and vast new fields", answer: "FALSE" },
                { question: 2, text: "the reservoirs behind dams can quickly fill up with silt", answer: "NOT GIVEN" },
                { question: 3, text: "the Green Revolution has greatly expanded worldwide farm production since 1950", answer: "FALSE" },
                { question: 4, text: "India, for example, has been self- sufficient in food for 15 years", answer: "NOT GIVEN" },
                { question: 5, text: "Polak asked what he needed to move out of poverty. \"Control of water for my crops,\" he said", answer: "TRUE" },
                { question: 6, text: "Over the next 12 years one and a half million farm families purchased treadle pumps", answer: "TRUE" },
                { question: 7, text: "two cylinders which are made of engineering plastic", answer: "bamboo" },
                { question: 8, text: "The diameter of a cylinder is 100.5mm and the height is 280mm", answer: "cylinders" },
                { question: 9, text: "The pump is capable of working up to a maximum depth of 7 meters", answer: "Piston" },
                { question: 10, text: "The pump mechanism has piston and foot valve assemblies", answer: "7" },
                { question: 11, text: "can irrigate half an acre of vegetables", answer: "half an acre" },
                { question: 12, text: "corrugated tin", answer: "corrugated tin" },
                { question: 13, text: "$37.5 million from the farmers themselves", answer: "$37.5 million" }
            ];

            // Define the text passages and their corresponding question numbers for Part 2 (Coastal Archaeology of Britain)
            const part2Highlights = [
                { question: 14, text: "the prospect of rising sea levels over the next century, and their impact on current coastal environments, has been a particular focus for concern", answer: "B" },
                { question: 15, text: "Most of the known wrecks around our coast are not unexpectedly of post-medieval date", answer: "C" },
                { question: 16, text: "Elaborate wooden fish weirs, often of considerable extent and responsive to aerial photography in shallow water", answer: "D" },
                { question: 17, text: "The dominant process affecting the physical form of England in the post- glacial period has been rising in the altitude of sea level relative to the land", answer: "TRUE" },
                { question: 18, text: "the constant reconfiguration of the coastline", answer: "FALSE" },
                { question: 19, text: "Its current location in the coastal zone is the product of later unrelated processes", answer: "TRUE" },
                { question: 20, text: "Boats were some of the most complex artefacts produced by pre-modem societies", answer: "FALSE" },
                { question: 21, text: "Similar boats were also discovered in many other European countries", answer: "NOT GIVEN" },
                { question: 22, text: "These industries are poorly documented", answer: "TRUE" },
                { question: 23, text: "The larger size of ferries has also caused an increase in the damage caused by their wash to fragile deposits in the intertidal zone", answer: "TRUE" },
                { question: 24, text: "we still have much to learn about their production and use", answer: "B" },
                { question: 25, text: "we are not yet in a position to make even preliminary estimates of answers to such fundamental questions as the extent to which the sea and the coast affected human life in the past", answer: "D" },
                { question: 26, text: "Human threats include the redevelopment of historic towns and old dockland areas", answer: "F" }
            ];

            // Define the text passages and their corresponding question numbers for Part 3 (Biology of Bitterness)
            const part3Highlights = [
                { question: 27, text: "Grapefruit and cruciferous vegetable like Brussels sprouts and kale are nutritious despite-and sometimes because of-their bitter-tasting components", answer: "B" },
                { question: 28, text: "In time, some taste researchers believe, compounds like AMP will help make processed foods less unhealthy", answer: "I" },
                { question: 29, text: "They defend plants by warning animals away and protect animals by letting them know when a plant may be poisonous", answer: "C" },
                { question: 30, text: "The G protein involved in the perception of bitterness, sweetness, and umami was identified", answer: "E" },
                { question: 31, text: "Amp has no bitterness of its own, but when put it in foods... it attaches to bitter-taste receptors", answer: "G" },
                { question: 32, text: "Part of the salt could be replaced by another salt, potassium chloride", answer: "H" },
                { question: 33, text: "naringin, a natural chemical compound found in grapefruit, tastes bitter", answer: "A" },
                { question: 34, text: "Some people, known as supertasters, are especially sensitive to 6-n-propylthiouraci because they have an unusually high number of taste buds", answer: "D" },
                { question: 35, text: "a substance called naringin contained in it", answer: "NARINGIN" },
                { question: 36, text: "letting them know when a plant may be poisonous", answer: "POISONOUS" },
                { question: 37, text: "About 75 percent of people are sensitive", answer: "SUPERTASTERS" },
                { question: 38, text: "unusually high number of taste buds", answer: "TASTEBUDS" },
                { question: 39, text: "offset bitter flavour in food", answer: "A" },
                { question: 40, text: "The G protein... triggers a cascade of chemical reactions that lead to changes in ion concentrations within the cell. Ultimately, this delivers a signal to the brain", answer: "D" }
            ];

            // Function to apply highlights to a passage
            function applyHighlights(passageElement, highlights) {
                if (!passageElement) return;

                // Clear any existing highlights
                passageElement.querySelectorAll('.answer-highlight').forEach(el => {
                    const parent = el.parentNode;
                    parent.replaceChild(document.createTextNode(el.textContent), el);
                    parent.normalize();
                });

                // Add highlights for each answer
                highlights.forEach(item => {
                    const paragraphs = passageElement.querySelectorAll('p');
                    paragraphs.forEach(paragraph => {
                        const html = paragraph.innerHTML;
                        if (!html || typeof html !== 'string') return;
                        if (html.includes(item.text)) {
                            const escapeRegExp = s => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                            const re = new RegExp(escapeRegExp(item.text));
                            const replaced = html.replace(
                                re,
                                `<span class="answer-highlight" data-question="${item.question}" style="
                                    background-color: #ffeb3b;
                                    padding: 2px 4px;
                                    border-radius: 3px;
                                    font-weight: bold;
                                    position: relative;
                                ">${item.text}<span style="
                                    position: absolute;
                                    top: -8px;
                                    right: -8px;
                                    background-color: #2196f3;
                                    color: white;
                                    border-radius: 50%;
                                    width: 20px;
                                    height: 20px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-size: 12px;
                                    font-weight: bold;
                                ">${item.question}</span></span>`
                            );
                            paragraph.innerHTML = replaced;
                        }
                    });
                });
            }

            // Apply highlights to Part 1 (Kedgeree)
            const passageText1 = document.getElementById('passage-text-1');
            applyHighlights(passageText1, part1Highlights);

            // Apply highlights to Part 2 (Coastal Archaeology of Britain)
            const passageText2 = document.getElementById('passage-text-2');
            applyHighlights(passageText2, part2Highlights);

            // Apply highlights to Part 3 (Biology of Bitterness)
            const passageText3 = document.getElementById('passage-text-3');
            applyHighlights(passageText3, part3Highlights);
        }

        function getUserAnswer(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            const radioInput = document.querySelector(`input[name="q${qNum}"]:checked`);
            const dropZone = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);

            if (textInput) { // Handles <input type="text"> and <select>
                return { value: textInput.value, text: textInput.value || 'N/A' };
            }
            if (radioInput) {
                return { value: radioInput.value, text: radioInput.value };
            }
            if (dropZone) {
                const droppedItem = dropZone.querySelector('.drag-item');
                return { 
                    value: droppedItem ? droppedItem.dataset.value : null, 
                    text: droppedItem ? droppedItem.textContent.trim() : 'N/A' 
                };
            }
            
            // Questions 24-26 are individual text input questions, not checkboxes
            
            // Handle clickable cells for questions 23-26
            if (qNum >= 23 && qNum <= 26) {
                const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"][data-selected="true"]`);
                if (selectedCell) {
                    return { value: selectedCell.dataset.answer, text: selectedCell.dataset.answer };
                }
            }
            return { value: null, text: 'N/A' };
        }

        function displayCorrectAnswer(qNum, correctAnswer) {
            // Questions 24-26 are individual text input questions, not checkboxes

            // Handle radio button questions by highlighting the correct label
            const correctRadioInput = document.querySelector(`input[name="q${qNum}"][value="${correctAnswer}"]`);
            if (correctRadioInput) {
                const parentOption = correctRadioInput.closest('.tf-option, .multi-choice-option');
                if (parentOption) {
                    parentOption.classList.add('correct-answer-highlight');
                    return;
                }
            }

            // Handle text inputs, select dropdowns, and others by showing the answer next to them
            const inputEl = document.getElementById(`q${qNum}`);
            if (inputEl) {
                const displaySpan = document.createElement('span');
                displaySpan.className = 'correct-answer-display';
                displaySpan.textContent = ` ✓ ${correctAnswer}`;
                inputEl.insertAdjacentElement('afterend', displaySpan);
                return; // Done
            }
            
            // Fallback for questions identified by a container (e.g., some T/F/NG questions)
            const element = findQuestionElement(qNum);
            if (element) {
                const displaySpan = document.createElement('span');
                displaySpan.className = 'correct-answer-display';
                displaySpan.textContent = ` ✓ ${correctAnswer}`;
                const itemContainer = element.querySelector('.tf-question-text');
                if (itemContainer) {
                     itemContainer.appendChild(displaySpan);
                } else {
                     element.appendChild(displaySpan);
                }
            }
        }
        
        function findQuestionElement(qNum) {
             return document.querySelector(`[data-q-start="${qNum}"]`);
        }

        function addResultToModal(qNum, userAnswer, correctAnswer, isCorrect) {
            const resultsDetails = document.getElementById('results-details');
            const row = document.createElement('div');
            row.className = 'result-row';
            if (!isCorrect) {
                row.classList.add('incorrect');
            }
            row.innerHTML = `
                <span class="q-num">${qNum}</span>
                <span class="user-ans">${userAnswer}</span>
                <span class="correct-ans">${correctAnswer}</span>
            `;
            resultsDetails.appendChild(row);
        }

        function showResultsModal() {
            document.getElementById('results-modal').classList.remove('hidden');
        }

        window.closeResultsModal = function() {
            document.getElementById('results-modal').classList.add('hidden');
            document.body.classList.remove('results-mode');
        }
        
        function disableInputs() {
            deliverButton.innerHTML = `<span>Checked! View Results.</span>`;
            deliverButton.removeEventListener('click', checkAnswers);
            deliverButton.onclick = showResultsModal;

            document.querySelectorAll('input, select').forEach(el => {
                el.disabled = true;
                 if (el.matches('input[type=radio], input[type=checkbox]')) {
                     el.style.cursor = 'not-allowed';
                     el.parentElement.style.cursor = 'not-allowed';
                 }
            });
            document.querySelectorAll('.drag-item').forEach(el => {
                el.setAttribute('draggable', 'false');
                el.style.cursor = 'default';
            });
            document.querySelectorAll('.drop-zone').forEach(el => {
                el.classList.add('disabled');
            });
        }

        function checkValue(userValue, correctValue) {
            if (userValue === null || userValue === undefined) return false;
            const formattedUserValue = userValue.trim().toLowerCase();
            if (Array.isArray(correctValue)) {
                return correctValue.map(v => v.toLowerCase()).includes(formattedUserValue);
            } else {
                return formattedUserValue === String(correctValue).toLowerCase();
            }
        }

        function markQuestion(qNum, isCorrect) {
            const subQuestionBtn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
            subQuestionBtn?.classList.add(isCorrect ? 'correct' : 'incorrect');

            const elementsToMark = [
                document.querySelector(`.tf-question[data-q-start="${qNum}"]`),
                document.querySelector(`.multi-choice-question[data-q-start="${qNum}"]`),
                document.querySelector(`.matching-question-item[data-q-start="${qNum}"]`),
                document.querySelector(`.drop-zone[data-q-start="${qNum}"]`),
                document.getElementById(`q${qNum}`),
                document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.tf-option'),
                document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.multi-choice-option')
            ];
            
            elementsToMark.forEach(el => {
                if (el) el.classList.add(isCorrect ? 'correct' : 'incorrect');
            });

             if (qNum === 14 || qNum === 15) {
                const multiChoiceContainer = document.querySelector('.multi-choice-question[data-q-start="14"]');
                if (multiChoiceContainer) multiChoiceContainer.classList.add(isCorrect ? 'correct' : 'incorrect');
             } else if (qNum >= 1 && qNum <= 5) {
                const pMatchInput = document.getElementById(`q${qNum}`);
                if (pMatchInput) pMatchInput.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
        }

        function switchToPart(partNumber) {
            console.log(`🔀 switchToPart called with partNumber: ${partNumber}, currentPassage: ${currentPassage}`);
            
            currentPassage = partNumber;

            // Hide all passages and questions
            document.querySelectorAll('.reading-passage, .question-set, .part-header').forEach(el => {
                el.classList.add('hidden');
            });

            // Show the correct passage, questions, and header
            document.getElementById(`passage-text-${partNumber}`).classList.remove('hidden');
            document.getElementById(`questions-${partNumber}`).classList.remove('hidden');
            document.getElementById(`part-header-${partNumber}`).classList.remove('hidden');

            // Update bottom navigation 'selected' state
            document.querySelectorAll('.footer__questionWrapper___1tZ46').forEach((wrapper, index) => {
                wrapper.classList.toggle('selected', (index + 1) === partNumber);
            });

            // Show/hide explanation buttons based on part
            const explanationButton = document.getElementById('show-explanation-btn');
            const explanationButtonPart3 = document.getElementById('show-explanation-btn-part3');
            
            if (explanationButton) {
                if (partNumber === 2) {
                    explanationButton.style.display = 'block';
                } else {
                    explanationButton.style.display = 'none';
                    // Hide explanation section when switching away from part 2
                    const explanationSection = document.getElementById('part-2-explanation');
                    if (explanationSection) {
                        explanationSection.classList.add('hidden');
                        explanationButton.textContent = 'Show Explanation';
                        explanationButton.style.backgroundColor = '#4a90e2';
                    }
                }
            }
            
            if (explanationButtonPart3) {
                if (partNumber === 3) {
                    explanationButtonPart3.style.display = 'block';
                } else {
                    explanationButtonPart3.style.display = 'none';
                    // Hide explanation section when switching away from part 3
                    const explanationSection = document.getElementById('part-3-explanation');
                    if (explanationSection) {
                        explanationSection.classList.add('hidden');
                        explanationButtonPart3.textContent = 'Show Explanation';
                        explanationButtonPart3.style.backgroundColor = '#4a90e2';
                    }
                }
            }

            console.log(`✅ switchToPart completed - switched to part ${partNumber}`);
            
            // Only go to first question when switching parts, not when staying in same part
            // This allows goToQuestion to work properly for specific question navigation
            // const firstQuestionOfPart = {1: 1, 2: 14, 3: 27}[partNumber];
            // goToQuestion(firstQuestionOfPart);
        }
        
        function goToQuestion(questionNumber) {
            console.log(`🎯 goToQuestion called with questionNumber: ${questionNumber}, currentQuestion: ${currentQuestion}, currentPassage: ${currentPassage}`);
            
            currentQuestion = questionNumber;

            let passageNumber = 1;
            if (questionNumber >= 14 && questionNumber <= 26) passageNumber = 2;
            else if (questionNumber >= 27) passageNumber = 3;
            
            console.log(`📍 Calculated passageNumber: ${passageNumber} for question ${questionNumber}`);
            
            if (currentPassage !== passageNumber) {
                console.log(`🔄 Switching from part ${currentPassage} to part ${passageNumber} for question ${questionNumber}`);
                switchToPart(passageNumber);
                return; 
            }

            console.log(`✅ Staying in same part (${currentPassage}) for question ${questionNumber}`);

            if (activeQuestionElement) {
                // Remove active style from previous block
                activeQuestionElement.classList.remove('active-question', 'active-input');
                // Also remove from the container block if we previously set it
                const prevBlock = activeQuestionElement.closest('[data-q-start]');
                if (prevBlock) prevBlock.classList.remove('active-question');
            }

            // First, try to find the specific input element for questions 33-36
            let targetEl = document.getElementById(`q${questionNumber}`);
            if (targetEl) {
                activeQuestionElement = targetEl;
                console.log(`✅ Found specific input element:`, targetEl);
                targetEl.classList.add('active-input');
                scrollIntoViewIfNeeded(targetEl);
            } else {
                // Fall back to looking for question containers
                targetEl = document.querySelector(`[data-q-start="${questionNumber}"]`);
                console.log(`🔍 Looking for target element with data-q-start="${questionNumber}":`, targetEl);

                if (targetEl) {
                    activeQuestionElement = targetEl;
                    console.log(`✅ Found target element:`, targetEl);
                    
                    if (targetEl.matches('input[type="text"]') || targetEl.matches('select')) {
                        targetEl.classList.add('active-input');
                        console.log(`📝 Added active-input class to input/select element`);
                    } else {
                        targetEl.classList.add('active-question');
                        console.log(`📋 Added active-question class to question element`);
                    }
                    scrollIntoViewIfNeeded(targetEl);
                } else {
                    console.log(`⚠️ Target element not found, looking for paragraph matching question`);
                    const pMatch = document.querySelector(`.paragraph-matching-question select[id="q${questionNumber}"]`);
                    if(pMatch) {
                        activeQuestionElement = pMatch;
                        pMatch.classList.add('active-input');
                        scrollIntoViewIfNeeded(pMatch);
                        console.log(`✅ Found paragraph matching question:`, pMatch);
                    } else {
                        console.log(`❌ No target element found for question ${questionNumber}`);
                    }
                }
            }

            updateNavigation();
            console.log(`✅ goToQuestion completed for question ${questionNumber}`);
        }
        
        // --- UI & NAVIGATION ---

        function updateNavigation() {
            console.log(`🔄 updateNavigation called for currentQuestion: ${currentQuestion}`);
            
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => btn.classList.remove('active'));
            const activeNav = document.querySelector(`.subQuestion[onclick="goToQuestion(${currentQuestion})"]`);
            if (activeNav) {
                activeNav.classList.add('active');
                console.log(`✅ Updated navigation - active nav button:`, activeNav);
            } else {
                console.log(`⚠️ No active navigation button found for question ${currentQuestion}`);
            }

            const inputs = document.querySelectorAll('.answer-input, .drop-zone.filled, .summary-drop-zone.filled');
            inputs.forEach(input => input.classList.remove('active-input'));
            
            const activeInput = document.getElementById(`q${currentQuestion}`);
            if (activeInput) {
                activeInput.classList.add('active-input');
                if (typeof activeInput.focus === 'function') {
                    activeInput.focus();
                }
                console.log(`✅ Focused on input element:`, activeInput);
            } else {
                console.log(`⚠️ No direct input found for question ${currentQuestion}, looking in question block`);
                // Prefer the specific question element for styling (TF/MCQ), fallback to any data-q-start container
                let activeQuestionBlock = document.querySelector(`.tf-question[data-q-start="${currentQuestion}"]`) 
                    || document.querySelector(`.multi-choice-question[data-q-start="${currentQuestion}"]`) 
                    || document.querySelector(`[data-q-start="${currentQuestion}"]`);
                if (activeQuestionBlock) {
                    // Add active-question class to style number badge
                    activeQuestionBlock.classList.add('active-question');
                    const firstInput = activeQuestionBlock.querySelector('input, select');
                    if(firstInput) {
                        firstInput.classList.add('active-input');
                         if (typeof firstInput.focus === 'function') {
                            firstInput.focus();
                        }
                        console.log(`✅ Focused on input in question block:`, firstInput);
                    } else {
                        console.log(`⚠️ No input found in question block for question ${currentQuestion}`);
                    }
                } else {
                    console.log(`❌ No question block found for question ${currentQuestion}`);
                }
            }
            
            console.log(`✅ updateNavigation completed`);
        }
        
        function selectDragItem(item) {
            if (selectedDragItem) {
                selectedDragItem.classList.remove('selected');
            }
            selectedDragItem = item;
            if (selectedDragItem) {
                selectedDragItem.classList.add('selected');
            }
        }
        
        window.nextQuestion = () => currentQuestion < 40 && goToQuestion(currentQuestion + 1);
        window.previousQuestion = () => currentQuestion > 1 && goToQuestion(currentQuestion - 1);

        function updateAllIndicators() {
            updateAttemptedCount(1, 1, 13);
            updateAttemptedCount(2, 14, 26);
            updateAttemptedCount(3, 27, 40);
            updateAnsweredNav();
        }
        
            function updateAnsweredNav() {
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => {
                const qNum = parseInt(btn.textContent, 10);
                if (isQuestionAnswered(qNum)) {
                    btn.classList.add('answered');
                } else {
                    btn.classList.remove('answered');
                }
            });
        }
        
            function isQuestionAnswered(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            if (textInput && (textInput.value.trim() !== '' || (textInput.classList.contains('drop-zone') && textInput.children.length > 0))) {
                return true;
            }
            const radio = document.querySelector(`input[name="q${qNum}"]:checked`);
            if (radio) {
                return true;
            }
            // Special handling for the combined checkbox group (Q20 & Q21)
            if (qNum === 20 || qNum === 21) {
                const checked = document.querySelectorAll('input[name="q20-21"]:checked');
                if (checked.length > 0) return true;
            }
            // Questions 24-26 are individual text input questions, not a checkbox group
            // Special handling for the checkbox group (Q32-34)
            if (qNum >= 32 && qNum <= 34) {
                const checked = document.querySelectorAll('input[name^="q32"]:checked');
                if (checked.length > 0) return true;
            }
            // Handle drag & drop questions (e.g., 20-23)
            const dz = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);
            if (dz && dz.querySelector('.drag-item')) {
                return true;
            }
            // Handle clickable-cell matrix questions (any question using clickable cells)
                const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"][data-selected="true"]`);
                if (selectedCell) {
                    return true;
            }
            return false;
        }

        function scrollIntoViewIfNeeded(element) {
            const panel = element.closest('.questions-panel, .passage-panel');
            const panelRect = panel.getBoundingClientRect();
            const elementRect = element.getBoundingClientRect();
            if (elementRect.top < panelRect.top || elementRect.bottom > panelRect.bottom) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // --- DRAG AND DROP ---
        
        function initializeDragAndDrop() {
            document.querySelectorAll('.drag-item').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('click', () => selectDragItem(item));
            });
            document.querySelectorAll('.drop-zone, .drag-options-container').forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            draggedItem = e.target;
            setTimeout(() => e.target.classList.add('dragging'), 0);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedItem = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            if (draggedItem && draggedItem.dataset.dndGroup === targetZone.dataset.dndGroup) {
                targetZone.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            targetZone.classList.remove('drag-over');

            if (!draggedItem || draggedItem.dataset.dndGroup !== targetZone.dataset.dndGroup) {
                return;
            }

            const sourceZone = draggedItem.parentElement;
            if (sourceZone === targetZone) return; // Prevent dropping on itself

            const existingItemInTarget = targetZone.classList.contains('drop-zone') 
                ? targetZone.querySelector('.drag-item') 
                : null;

            // First, clear the target drop-zone of any text (like question numbers) before adding the new item.
            if (targetZone.classList.contains('drop-zone')) {
                Array.from(targetZone.childNodes).forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        node.remove();
                    }
                });
            }

            // Move the item that was in the target (if any) to the source zone.
            if (existingItemInTarget) {
                sourceZone.appendChild(existingItemInTarget);
            }
            
            // Finally, move the dragged item to the target zone.
            targetZone.appendChild(draggedItem);
            targetZone.classList.add('filled');
            // Lock the pill-like appearance for items dropped into zones
            if (draggedItem) {
                draggedItem.style.cursor = 'default';
            }
            // Hide placeholder text (question number) once filled
            if (targetZone.textContent && /^\d+$/.test(targetZone.textContent.trim())) {
                targetZone.textContent = '';
            }

            // After the move, clean up the source zone if it's a drop-zone and is now empty.
            if (sourceZone.classList.contains('drop-zone') && !sourceZone.querySelector('.drag-item')) {
                 sourceZone.classList.remove('filled');
                 const qNum = sourceZone.dataset.qStart;
                 sourceZone.innerText = qNum; // Restore the question number
            }
            
            updateAllIndicators();
        }
        
        // --- MISC HELPERS ---
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval); // Ensure no multiple intervals
            timerInterval = setInterval(() => {
                timeInSeconds--;
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = timeInSeconds % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                if (timeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's up!";
                    // checkAnswers(); // Disabled to prevent modal from opening automatically.
                }
            }, 1000);
            timerToggleButton.innerHTML = pauseIcon;
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            timerToggleButton.innerHTML = playIcon;
        }

        function toggleTimer() {
            // Check based on the icon currently displayed
            if (timerToggleButton.innerHTML.includes('M6 19h4V5H6v14z')) { // Check for pause icon shape
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function resetTimer() {
            timeInSeconds = 3600;
            const minutes = Math.floor(timeInSeconds / 60);
            const seconds = timeInSeconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            startTimer();
            timerToggleButton.innerHTML = pauseIcon;
        }
        
        function setupCheckboxLimits() {
            const checkboxGroups = [
                { name: 'q20-21', limit: 2 },
                { name: 'q32', limit: 3, pattern: 'q32[A-F]' },
                { name: 'q38-40', limit: 3 }
                // Questions 24-26 are individual text input questions, not checkboxes
            ];
            checkboxGroups.forEach(group => {
                let checkboxes;
                if (group.pattern) {
                    // Use regex pattern for questions like 32-34
                    checkboxes = document.querySelectorAll(`input[name^="${group.name.replace(/[A-F]$/, '')}"]`);
                } else {
                    checkboxes = document.querySelectorAll(`input[name="${group.name}"]`);
                }
                
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        let checkedCount;
                        if (group.pattern) {
                            checkedCount = document.querySelectorAll(`input[name^="${group.name.replace(/[A-F]$/, '')}"]:checked`).length;
                        } else {
                            checkedCount = document.querySelectorAll(`input[name="${group.name}"]:checked`).length;
                        }
                        
                        if (checkedCount >= group.limit) {
                            // Disable all unchecked checkboxes
                            checkboxes.forEach(cb => {
                                if (!cb.checked) {
                                    cb.disabled = true;
                                    cb.parentElement.style.opacity = '0.5';
                                    cb.parentElement.style.cursor = 'not-allowed';
                                }
                            });
                        } else {
                            // Enable all checkboxes
                            checkboxes.forEach(cb => {
                                cb.disabled = false;
                                cb.parentElement.style.opacity = '1';
                                cb.parentElement.style.cursor = 'pointer';
                            });
                        }
                        
                        if (checkedCount > group.limit) {
                            checkbox.checked = false;
                        }
                        
                        updateAllIndicators();
                    });
                });
            });
        }

        function setupExampleHeading() {
            const exampleBox = document.querySelector('.example-box');
            if(exampleBox){
                const title = document.createElement('p');
                title.style.fontWeight = 'bold';
                title.textContent = 'List of Statements';
                // exampleBox.insertBefore(title, exampleBox.firstChild);
            }
        }
        
        function initResize(e) {
            e.preventDefault();
            const startX = e.clientX;
            const startWidth = passagePanel.offsetWidth;
            
            const doDrag = (e) => {
                const newWidth = startWidth + e.clientX - startX;
                if (newWidth > 200 && (document.body.clientWidth - newWidth - resizer.offsetWidth) > 200) {
                    passagePanel.style.flex = `0 0 ${newWidth}px`;
                }
            };
            const stopDrag = () => {
                window.removeEventListener('mousemove', doDrag, false);
                window.removeEventListener('mouseup', stopDrag, false);
            };
            
            window.addEventListener('mousemove', doDrag, false);
            window.addEventListener('mouseup', stopDrag, false);
        }
        
        // --- CONTEXT MENU (Highlighting) ---
        
        function initializeContextMenu() {
            const panels = [passagePanel, questionsPanel];
            let targetElementForClear = null;

            // This listener simply tracks the last valid text selection in either panel.
            document.addEventListener('selectionchange', () => {
                const selection = window.getSelection();
                if (selection && !selection.isCollapsed && selection.toString().trim().length > 0) {
                    const range = selection.getRangeAt(0);
                    if (panels.some(panel => panel.contains(range.commonAncestorContainer))) {
                        selectedRange = range;
                        targetElementForClear = null; // New selection overrides clearing a specific element
                    }
                }
            });

            const showContextMenu = (e) => {
                const target = e.target;
                const isClickOnHighlight = target.closest('.highlight, .comment-highlight');
                const isSelectionActive = selectedRange && selectedRange.toString().trim().length > 0;
                
                let showMenu = false;

                if (isClickOnHighlight) {
                    document.getElementById('menu-highlight').style.display = 'none';
                    document.getElementById('menu-note').style.display = 'none';
                    document.getElementById('menu-clear').style.display = 'block';
                    document.getElementById('menu-clear-all').style.display = 'block';
                    contextMenu.targetElementForClear = isClickOnHighlight;
                    showMenu = true;
                } else if (isSelectionActive && panels.some(panel => panel.contains(selectedRange.commonAncestorContainer))) {
                    document.getElementById('menu-highlight').style.display = 'flex';
                    document.getElementById('menu-note').style.display = 'flex';
                    document.getElementById('menu-clear').style.display = 'none';
                    document.getElementById('menu-clear-all').style.display = 'block'; // Always show clear all
                    showMenu = true;
                }

                if (showMenu) {
                    e.preventDefault();
                    contextMenu.style.display = 'block';
                    const menuHeight = contextMenu.offsetHeight;
                    const menuWidth = contextMenu.offsetWidth;
                    let left = e.pageX;
                    let top = e.pageY;
                    if (left + menuWidth > window.innerWidth) left = window.innerWidth - menuWidth - 5;
                    if (top + menuHeight > window.innerHeight) top = e.pageY - menuHeight - 5;
                    else top = e.pageY - menuHeight - 5;
                    
                    contextMenu.style.left = `${left}px`;
                    contextMenu.style.top = `${top}px`;
                }
            };

            panels.forEach(panel => {
                panel.addEventListener('contextmenu', showContextMenu);
            });

            document.addEventListener('click', (e) => {
                if (contextMenu.style.display === 'block' && !contextMenu.contains(e.target)) {
                    closeContextMenu();
                }
            });
        }

        function closeContextMenu() {
            contextMenu.style.display = 'none';
            selectedRange = null; // Clear range after menu closes
        }

        function unwrapElement(element) {
            const parent = element.parentNode;
            if (!parent) return;
            while (element.firstChild) {
                parent.insertBefore(element.firstChild, element);
            }
            parent.removeChild(element);
            parent.normalize();
        }

        window.highlightText = () => {
            if (selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'highlight';
                span.appendChild(selectedRange.extractContents());
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.addNote = () => {
            const note = prompt('Enter your note:');
            if (note && selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'comment-highlight';
                const tooltip = document.createElement('span');
                tooltip.className = 'comment-tooltip';
                tooltip.textContent = note;
                span.appendChild(selectedRange.extractContents());
                span.appendChild(tooltip);
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.clearHighlight = () => {
             const elementToClear = contextMenu.targetElementForClear;
             if (elementToClear) {
                 unwrapElement(elementToClear);
             }
             closeContextMenu();
             window.getSelection().removeAllRanges();
        };
        
        window.clearAllHighlights = () => {
            document.querySelectorAll('.highlight, .comment-highlight').forEach(unwrapElement);
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        function updateAttemptedCount(part, startQ, endQ) {
            let answeredCount = 0;
            for (let i = startQ; i <= endQ; i++) {
                if (isQuestionAnswered(i)) {
                    answeredCount++;
                }
            }
            const partHeader = document.querySelector(`.footer__questionNo___3WNct[onclick="switchToPart(${part})"]`);
            if (partHeader) {
                const countSpan = partHeader.querySelector('.attemptedCount');
                if (countSpan) {
                     countSpan.textContent = `${answeredCount} of ${endQ - startQ + 1}`;
                }
            }
        }

        // --- GLOBAL FUNCTION EXPOSURE ---
        window.nextQuestion = nextQuestion;
        window.previousQuestion = previousQuestion;
        window.goToQuestion = goToQuestion;
        window.switchToPart = switchToPart;
        window.closeResultsModal = closeResultsModal;
        window.highlightText = highlightText;
        window.addNote = addNote;
        window.clearHighlight = clearHighlight;
        window.clearAllHighlights = clearAllHighlights;
        
        // Explanation toggle function for Part 2
        window.toggleExplanation = function() {
            const explanationSection = document.getElementById('part-2-explanation');
            const button = document.getElementById('show-explanation-btn');
            
            if (explanationSection.classList.contains('hidden')) {
                explanationSection.classList.remove('hidden');
                button.textContent = 'Hide Explanation';
                button.style.backgroundColor = '#dc3545';
            } else {
                explanationSection.classList.add('hidden');
                button.textContent = 'Show Explanation';
                button.style.backgroundColor = '#4a90e2';
            }
        };
        
        // Explanation toggle function for Part 3
        window.toggleExplanationPart3 = function() {
            const explanationSection = document.getElementById('part-3-explanation');
            const button = document.getElementById('show-explanation-btn-part3');
            
            if (explanationSection.classList.contains('hidden')) {
                explanationSection.classList.remove('hidden');
                button.textContent = 'Hide Explanation';
                button.style.backgroundColor = '#dc3545';
            } else {
                explanationSection.classList.add('hidden');
                button.textContent = 'Show Explanation';
                button.style.backgroundColor = '#4a90e2';
            }
        };

        // --- START THE APP ---
        initialize();

        // Add event listeners for table radio buttons
        document.addEventListener('DOMContentLoaded', function() {
            const tableRadios = document.querySelectorAll('.table-radio');
            tableRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    // Remove background color from all cells in the same row
                    const row = this.closest('tr');
                    const cells = row.querySelectorAll('td:not(.statement)');
                    cells.forEach(cell => {
                        cell.style.backgroundColor = '';
                    });
                    
                    // Add background color to the selected cell
                    if (this.checked) {
                        this.closest('td').style.backgroundColor = '#e3f2fd';
                    }
                    
                    updateAllIndicators();
                });
            });
            

        });

        // Global function for selecting cells
        window.selectCell = function(cell, questionNum, value) {
            console.log('selectCell called:', questionNum, value);
            
            // Remove selected class from all cells in the same row
            const row = cell.closest('tr');
            const cellsInRow = row.querySelectorAll('.clickable-cell');
            cellsInRow.forEach(c => {
                c.classList.remove('selected');
                c.removeAttribute('data-selected');
                c.removeAttribute('data-answer');
            });
            
            // Add selected class to clicked cell
            cell.classList.add('selected');
            cell.setAttribute('data-selected', 'true');
            cell.setAttribute('data-answer', value);
            
            console.log('Cell selected:', questionNum, value);
            updateAllIndicators();
        };



        // Note: switchToPart function is defined earlier in the code
        // This duplicate function has been removed to prevent conflicts

        // Drag and Drop Functions for Questions 14-20
        window.drag = function(event) {
            // Only allow dragging if the element is visible
            if (event.target.style.display === 'none') {
                event.preventDefault();
                return false;
            }
            event.dataTransfer.setData("text", event.target.getAttribute('data-heading'));
            event.target.classList.add('dragging');
        };

        window.allowDrop = function(event) {
            event.preventDefault();
            event.target.classList.add('drag-over');
        };

        window.dragFromZone = function(event) {
            if (event.target.classList.contains('filled')) {
                const headingId = event.target.getAttribute('data-answer');
                event.dataTransfer.setData("text", headingId);
                event.dataTransfer.setData("source", "zone");
                event.dataTransfer.setData("sourceParagraph", event.target.getAttribute('data-paragraph'));
                event.target.classList.add('dragging');
            } else {
                event.preventDefault();
                return false;
            }
        };

        window.drop = function(event) {
            event.preventDefault();
            event.target.classList.remove('drag-over');
            
            const headingId = event.dataTransfer.getData("text");
            const source = event.dataTransfer.getData("source");
            const sourceParagraph = event.dataTransfer.getData("sourceParagraph");
            const dropZone = event.target;
            const paragraph = dropZone.getAttribute('data-paragraph');
            
            if (!dropZone.classList.contains('paragraph-drop-zone')) return;
            
            // Find the dragged element (from options list)
            const draggedElement = document.querySelector(`[data-heading="${headingId}"]`);
            
            if (source === "zone") {
                // Dragging from zone to zone (swapping)
                const sourceZone = document.querySelector(`[data-paragraph="${sourceParagraph}"]`);
                const currentAnswer = dropZone.getAttribute('data-answer');
                
                if (currentAnswer && currentAnswer !== headingId) {
                    // Swap the items
                    const currentElement = document.querySelector(`[data-heading="${currentAnswer}"]`);
                    
                    // Move current item to source zone
                    sourceZone.textContent = currentElement.textContent;
                    sourceZone.setAttribute('data-answer', currentAnswer);
                    
                    // Update inputs
                    const sourceInput = document.getElementById(`q${14 + ['A','B','C','D','E','F','G'].indexOf(sourceParagraph)}`);
                    if (sourceInput) sourceInput.value = currentAnswer;
                } else {
                    // Clear source zone if no swap needed
                    const sourceQuestionNumber = 14 + ['A','B','C','D','E','F','G'].indexOf(sourceParagraph);
                    sourceZone.textContent = sourceQuestionNumber;
                    sourceZone.classList.remove('filled');
                    sourceZone.removeAttribute('data-answer');
                    sourceZone.setAttribute('draggable', 'false');
                    
                    // Clear source input
                    const sourceInput = document.getElementById(`q${sourceQuestionNumber}`);
                    if (sourceInput) sourceInput.value = '';
                }
                
                // Update drop zone
                if (draggedElement) {
                    dropZone.textContent = draggedElement.textContent;
                    dropZone.classList.add('filled');
                    dropZone.setAttribute('data-answer', headingId);
                    dropZone.setAttribute('draggable', 'true');
                }
                
            } else {
                // Dragging from options list to zone
                if (draggedElement) {
                    // Check if this drop zone already has an answer
                    const previousAnswer = dropZone.getAttribute('data-answer');
                    if (previousAnswer && previousAnswer !== headingId) {
                        // Return the previous option to the options list
                        const previousElement = document.querySelector(`[data-heading="${previousAnswer}"]`);
                        if (previousElement) {
                            previousElement.classList.remove('used');
                            previousElement.setAttribute('draggable', 'true');
                            previousElement.style.display = 'block';
                        }
                    }
                    
                    // Update the drop zone content
                    dropZone.textContent = draggedElement.textContent;
                    dropZone.classList.add('filled');
                    dropZone.setAttribute('data-answer', headingId);
                    dropZone.setAttribute('draggable', 'true');
                    
                    // Hide the dragged element completely (remove from options list)
                    draggedElement.style.display = 'none';
                    draggedElement.classList.add('used');
                    draggedElement.setAttribute('draggable', 'false');
                }
            }
            
            // Update the corresponding input
            const inputElement = document.getElementById(`q${14 + ['A','B','C','D','E','F','G'].indexOf(paragraph)}`);
            if (inputElement) {
                inputElement.value = headingId;
            }
            
            console.log(`Dropped ${headingId} on paragraph ${paragraph}`);
            updateAllIndicators();
        };

        // Remove drag-over class when drag leaves
        document.addEventListener('dragleave', function(event) {
            if (event.target.classList.contains('paragraph-drop-zone')) {
                event.target.classList.remove('drag-over');
            }
        });

        // Remove dragging class when drag ends
        document.addEventListener('dragend', function(event) {
            if (event.target.classList.contains('heading-drag-item')) {
                event.target.classList.remove('dragging');
            }
        });

        // Allow clearing drop zones by double-clicking
        document.addEventListener('dblclick', function(event) {
            if (event.target.classList.contains('paragraph-drop-zone') && event.target.classList.contains('filled')) {
                const headingId = event.target.getAttribute('data-answer');
                const draggedElement = document.querySelector(`[data-heading="${headingId}"]`);
                
                if (draggedElement) {
                    // Reset the drop zone
                    const paragraph = event.target.getAttribute('data-paragraph');
                    const questionNumber = 14 + ['A','B','C','D','E','F','G'].indexOf(paragraph);
                    event.target.textContent = questionNumber;
                    event.target.classList.remove('filled');
                    event.target.removeAttribute('data-answer');
                    
                    // Show the dragged element back in options list
                    draggedElement.classList.remove('used');
                    draggedElement.setAttribute('draggable', 'true');
                    draggedElement.style.display = 'block';
                    
                    // Clear the corresponding input
                    const inputElement = document.getElementById(`q${questionNumber}`);
                    if (inputElement) {
                        inputElement.value = '';
                    }
                    
                    updateAllIndicators();
                }
            }
        });
    });
    </script>
</body>
</html>
